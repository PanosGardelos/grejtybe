"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[13986],{305630:(e,n,t)=>{t.d(n,{Z:()=>ee});var r=t(785893),a=t(667294),i=t(441143),l=t.n(i),s=t(496486),o=t.n(s),u=t(791462),c=t(365523),d=t(489992),p=t(642400),f=t(579220),I=t(549425),_=t(735713),E=t(662322),S=t(956345),m=t(565922),h=t(640753),y=t(451620),T=t(356004),N=t(105405),v=t(893321),P=t(630206),b=t(859023),A=t(191940),O=t(513857),C=t(487502),g=t(693518),R=t(82961),M=t(562181),L=t(521495),x=t(726283),j=t(202036),Z=t(590483),G=t(461061),w=t(298716),U=t(959797),k=t(5759),D=t.n(k);function B(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function H(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function F(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}function W(e){
W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return W(e)}function Y(e,n){return!n||"object"!==Q(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function K(e,n){K=Object.setPrototypeOf||function(e,n){e.__proto__=n;return e};return K(e,n)}function V(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||z(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e){
return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Q=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function z(e,n){if(e){if("string"==typeof e)return B(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);return"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?B(e,n):void 0}}function J(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){
return!1}}();return function(){var t,r=W(e);if(n){var a=W(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return Y(this,t)}}var q=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}});n&&K(e,n)}(t,e);var n=J(t);function t(){H(this,t);var e;(e=n.apply(this,arguments)).state={copyMode:O.Z.Modes.DEFAULT};e._copyModeTimeout=new c.V7;e.handleGiftCodeCopy=function(n,t){var r=e.props.sku;null!=r&&(0,j.dM)(new y.Z({code:t,maxUses:1}),r);try{(0,x.JG)(n);e.setState({copyMode:O.Z.Modes.SUCCESS})}catch(n){e.setState({copyMode:O.Z.Modes.ERROR})}e._copyModeTimeout.start(1500,(function(){e.setState({copyMode:O.Z.Modes.DEFAULT})}))};e.handleInventoryClick=function(){S.Z.open(G.oAB.INVENTORY);e.props.onClose()};return e}var a=t.prototype;a.componentWillUnmount=function(){
this._copyModeTimeout.stop()};a.render=function(){var e,n=this,t=this.props,a=t.obscureGiftCode,i=t.giftCode,l=t.application,s=t.onClose,o=t.selectedGiftStyle,u=this.state.copyMode;switch(u){case O.Z.Modes.SUCCESS:e=U.Z.Messages.BILLING_GIFT_COPIED;break;case O.Z.Modes.ERROR:e=U.Z.Messages.FAILED;break;default:e=U.Z.Messages.COPY}return(0,r.jsxs)(C.Z,{direction:C.Z.Direction.VERTICAL,align:C.Z.Align.CENTER,children:[null!=l?(0,r.jsx)(g.Z,{game:l,className:D().icon,size:g.Z.Sizes.LARGE,skuId:this.iconSKUId}):null,(0,r.jsx)(d.X6,{variant:"heading-lg/semibold",className:null!=o?D().headerSeasonalGifting:D().header,children:U.Z.Messages.APPLICATION_STORE_PURCHASE_GIFT_CONFIRMATION_TITLE}),(0,r.jsx)("div",{className:D().blurb,children:this.headerBlurb}),(0,r.jsx)($,{giftCode:i,onClose:s}),(0,r.jsx)("div",{className:D().divider}),(0,r.jsxs)(C.Z,{direction:C.Z.Direction.VERTICAL,children:[(0,r.jsx)(M.vw,{children:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_PRIVATE_LINK}),null!=i?(0,
r.jsx)(O.Z,{hideMessage:a?U.Z.Messages.GIFT_INVENTORY_HIDDEN:null,value:(0,j.Nz)(i),mode:u,text:e,onCopy:function(e){return n.handleGiftCodeCopy(e,i)},supportsCopy:x.wS,className:D().copyInput,buttonColor:O.Z.ButtonColors.LINK,buttonLook:O.Z.ButtonLooks.LINK}):null,(0,r.jsx)("div",{className:D().subtext,children:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_CONFIRMATION_SUBTEXT_NO_FORMAT})]})]})};!function(e,n,t){n&&F(e.prototype,n);t&&F(e,t)}(t,[{key:"iconSKUId",get:function(){var e=this.props,n=e.subscriptionPlan,t=e.sku;return null!=n?n.skuId:null!=t?t.id:null}},{key:"headerBlurb",get:function(){var e=this.props.subscriptionPlan,n=U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_CONFIRMATION_BLURB;if(null!=e){n=(e.interval===w.rV.MONTH?U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_CONFIRM_SUBSCRIPTION_MONTHLY:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_CONFIRM_SUBSCRIPTION_YEARLY).format({skuName:(0,Z.aq)(e.id),intervalCount:e.intervalCount})}return n}}]);return t
}(a.Component),$=function(e){var n=e.giftCode,t=e.onClose;a.useEffect((function(){_.Z.fetchRelationships();(0,E.W)()}),[]);var i=null!=n&&""!==n?(0,j.Nz)(n):null,s=V(a.useState(),2),c=s[0],d=s[1],S=V(a.useState(!1),2),y=S[0],v=S[1],O=V(a.useState(!1),2),C=O[0],g=O[1],x=(0,u.cj)([P.Z],(function(){return{userAffinities:P.Z.getUserAffinities(),isLoading:P.Z.getFetching()}})),Z=x.userAffinities,G=x.isLoading,w=o().map(Z,"user_id"),k=(0,u.e7)([N.Z],(function(){return N.Z.getFriendIDs()})),B=o().difference(k,w),H=X(w).concat(X(B)),F=(0,u.e7)([b.default],(function(){return b.default.filter((function(e){return H.includes(e.id)&&!e.bot}))}),[H]);if(null==F||0===F.length)return null;var W=o().sortBy(F,(function(e){return H.indexOf(e.id)}));return(0,r.jsxs)("div",{className:D().giftRecipientSection,children:[(0,r.jsx)(M.vw,{children:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_GIFT_RECIPIENT_SECTION_LABEL}),(0,r.jsxs)("div",{className:D().giftRecipient,children:[(0,r.jsx)(L.Z,{
placeholder:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_GIFT_RECIPIENT_SELECT_PLACEHOLDER,wrapperClassName:D().giftRecipientInputWrapper,className:y?D().giftRecipientInputError:void 0,renderOptionPrefix:function(e){return null==(null==e?void 0:e.value)?null:(0,r.jsx)(m.Z,{user:e.value,size:m.u.SIZE_20})},renderLeading:function(){return G?(0,r.jsx)(R.Z,{type:R.R.PULSING_ELLIPSIS}):null},value:c,onChange:function(e){d(e);v(!1)},options:W.map((function(e){return{value:e,label:"".concat(e.toString(),"#").concat(e.discriminator)}}))}),(0,r.jsx)(A.Co,{disabled:null==c,submitting:C,className:D().sendToRecipientButton,onClick:function(){g(!0);p.Z.openPrivateChannel(c.id).then((function(e){var n=T.Z.getChannel(e);l()(null!=n,"Ensured PrivateChannel is null");l()(null!=i,"giftCodeURL is null");I.Z.sendMessage(n.id,h.ZP.parse(n,i),void 0,{isGiftLinkSentOnBehalfOfUser:!0}).then((function(){t();(0,f.Ou)()})).catch((function(){v(!0);g(!1)}))}))},
children:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_GIFT_SEND_NOW_BUTTON})]}),(0,r.jsx)("div",{className:y?D().subtextError:D().subtext,children:y?U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_GIFT_ERROR_SENDING_LINK:U.Z.Messages.APPLICATION_STORE_GIFT_PURCHASE_GIFT_RECIPIENT_SUBTEXT})]})};const ee=u.ZP.connectStores([v.Z],(function(){return{obscureGiftCode:v.Z.enabled}}))(q)},28825:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(667294),a=t(173436);function i(e){var n=(0,r.useRef)(e);(0,r.useEffect)((function(){n.current=e}),[e]);(0,r.useEffect)((function(){if(__OVERLAY__){var e=function(e){e.locked&&n.current()};a.Z.subscribe("OVERLAY_SET_INPUT_LOCKED",e);return function(){a.Z.unsubscribe("OVERLAY_SET_INPUT_LOCKED",e)}}}),[])}},851225:(e,n,t)=>{t.d(n,{Em:()=>l,sE:()=>s,ZP:()=>o});var r=t(553494),a=t(590483),i=(0,r.B)({kind:"user",id:"2022-06_no_payment_info_trial",label:"No Payment Info Trial",defaultConfig:{bypassCheckout:!1},treatments:[{id:1,label:"Bypass collecting payment info",config:{
bypassCheckout:!0}}]}),l=function(e,n,t){var r=null==t||(0,a.uZ)(t);return null!=e&&null==n&&r},s=function(e,n,t){var r=i.useExperiment({}).bypassCheckout,a=l(e,n,t);return r&&a};const o=i},546005:(e,n,t)=>{t.d(n,{Z:()=>r});const r=(0,t(553494).B)({kind:"user",id:"2022-04_payment_modal_refactor",label:"Payment Modal Refactor",defaultConfig:{newModal:!1},treatments:[{id:1,label:"Use refactored modal.",config:{newModal:!0}}]})},695784:(e,n,t)=>{t.d(n,{v:()=>I});var r=t(441143),a=t.n(r),i=t(530853),l=t(967543),s=t(932847),o=t(658350),u=t(390599),c=t(461061);function d(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))));r.forEach((function(n){d(e,n,t[n])}))}
return e}function f(e,n){n=null!=n?n:{};Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})));t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}));return e}function I(e){var n=e.analyticsData,t=e.initialPlanId,r=e.breadcrumbSteps,d=e.handleStepChange,I=(0,o.usePaymentContext)(),_=I.contextMetadata,E=I.step,S=I.paymentSources,m=I.paymentSourceId,h=I.setPaymentSourceId,y=I.purchaseError,T=I.setPurchaseError,N=I.purchaseErrorBlockRef,v=I.paymentAuthenticationState,P=f(p({},(0,l.fL)()),{paymentSources:S,paymentSourceId:m,setPaymentSourceId:h,purchaseError:y,setPurchaseError:T,purchaseErrorBlockRef:N,paymentAuthenticationState:v});a()(E,"Step should be set here");var b=(0,
i.Z)((function(){return Date.now()}),[E]);return(0,l.vP)({paymentModalArgs:P,initialStep:u.h8.PAYMENT_TYPE,prependSteps:[u.h8.PROMOTION_INFO],appendSteps:[u.h8.REVIEW,u.h8.CONFIRM],breadcrumpSteps:r,currentBreadcrumpStep:E,usePaymentModalStep:!0,onReturn:function(){var e=Object.values(S).length<1&&null==t?u.h8.PLAN_SELECT:u.h8.REVIEW;d(e,u.h8.PAYMENT_TYPE)},onComplete:function(e){d(u.h8.REVIEW,e)},onStepChange:function(e){var t=e.currentStep,r=e.toStep,a=Date.now();s.default.track(c.rMx.PAYMENT_FLOW_STEP,f(p({},n),{from_step:t,to_step:r,step_duration_ms:a-b,flow_duration_ms:a-_.startTime}))}})}},851604:(e,n,t)=>{t.r(n);t.d(n,{OldPremiumPaymentModal:()=>dt,PremiumAwaitingAuthenticationStep:()=>ft,PremiumAwaitingPurchaseTokenAuthStep:()=>pt,PremiumPaymentModal:()=>vt,PremiumPaymentReviewStep:()=>Tt,PremiumPaymentSpinner:()=>_t,STEPS:()=>It,default:()=>Pt})
;var r=t(785893),a=t(667294),i=t(294184),l=t.n(i),s=t(441143),o=t.n(s),u=t(126136),c=t(530853),d=t(468811),p=t.n(d),f=t(791462),I=t(173436),_=t(737325),E=t(358623),S=t(512172),m=t(174034),h=t(879605),y=t(335065),T=t(489992),N=t(658350),v=t(587583),P=t(892472),b=t(191940),A=t(487502),O=t(67416),C=t(959797),g=t(547656),R=t.n(g);function M(e,n,t,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){t(e);return}s.done?n(o):Promise.resolve(o).then(r,a)}var L=function(e,n){var t,r,a,i,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;(r=0,a)&&(i=[2&i[0],a.value]);switch(i[0]){case 0:case 1:a=i;break;case 4:l.label++;return{
value:i[1],done:!1};case 5:l.label++;r=i[1];i=[0];continue;case 7:i=l.ops.pop();l.trys.pop();continue;default:if(!(a=l.trys,a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1];a=i;break}if(a&&l.label<a[2]){l.label=a[2];l.ops.push(i);break}a[2]&&l.ops.pop();l.trys.pop();continue}i=n.call(e,l)}catch(e){i=[6,e];r=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},x=function(e){var n=e.className,t=e.isEmailResent,a=e.resendEmail;return(0,r.jsx)("div",{className:n,children:(0,r.jsxs)("div",{className:R().awaitingWrapper,children:[(0,r.jsx)(T.X6,{variant:"heading-xl/bold",children:C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_HEADER}),(0,r.jsxs)("p",{children:[(0,r.jsx)(T.xv,{variant:"text-md/normal",children:C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL}),(0,r.jsx)("br",{}),(0,r.jsx)(T.xv,{
variant:"text-md/normal",children:C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_INSTRUCTIONS}),(0,r.jsx)("br",{}),(0,r.jsxs)(T.xv,{variant:"text-md/normal",children:[C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_RESEND_PROMPT,"Â ",t?C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_RESEND_SENT:(0,r.jsx)(P.Z,{onClick:a,children:C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_RESEND_ACTION})]})]})]})})},j=function(){return(0,r.jsx)("div",{children:(0,r.jsx)(O.mz,{justify:A.Z.Justify.BETWEEN,align:A.Z.Align.CENTER,children:(0,r.jsx)(b.Co,{"data-testid":"continue",color:b.Co.Colors.BRAND,disabled:!0,children:C.Z.Messages.PAYMENT_WAITING_FOR_PURCHASE_TOKEN_AUTHORIZATION_MODAL_NEXT_BUTTON})})})};function Z(e){var n,t,a=e.steps,i=e.currentStep,l=e.paymentError,s=e.className,o=e.isEmailResent,u=e.setIsEmailResent,c=(t=(n=function(){return L(this,(function(e){switch(e.label){case 0:u(!0);return[4,(0,S.xA)()]
;case 1:e.sent();return[2]}}))},function(){var e=this,t=arguments;return new Promise((function(r,a){var i=n.apply(e,t);function l(e){M(i,r,a,l,s,"next",e)}function s(e){M(i,r,a,l,s,"throw",e)}l(void 0)}))}),function(){return t.apply(this,arguments)});return(0,r.jsx)(v.Z,{steps:a,currentStep:i,paymentError:l,body:(0,r.jsx)(x,{className:s,isEmailResent:o,resendEmail:c}),footer:(0,r.jsx)(j,{})})}var G=t(812314),w=t(952013),U=t(859169),k=t(64833),D=t(767121),B=t(84840),H=t(28825),F=t(124966),W=t(43833),Y=t(553494),K=t(298716);const V=(0,Y.B)({kind:"user",id:"2022-02_multi_month_plans",label:"Multi Month Plans",defaultConfig:{newPlans:[]},treatments:[{id:1,label:"3 and 6 Month Plans",config:{newPlans:[K.Xh.PREMIUM_6_MONTH_TIER_2,K.Xh.PREMIUM_3_MONTH_TIER_2]}},{id:2,label:"3 Month Plan Only",config:{newPlans:[K.Xh.PREMIUM_3_MONTH_TIER_2]}}]});var X=new Set([W.S.US,W.S.CA]);function Q(e){return null==e||X.has(e.country)}
var z=t(916061),J=t(742720),q=t(852097),$=t(859023),ee=t(370678),ne=t(503035),te=t(337267),re=t.n(te);const ae=function(e){var n=e.trialId,t=e.isGift,a=e.plan,i=(0,f.e7)([$.default],(function(){return $.default.getCurrentUser()})),l=(0,ne.Mh)(i,n,t,a),s=l.shouldShowUpsells;return!l.isLoading&&s?(0,r.jsxs)("div",{className:re().bogoPromo,children:[(0,r.jsx)(ee.Z,{className:re().giftIcon}),(0,r.jsx)(T.X6,{className:re().textHeader,color:"always-white",variant:"heading-deprecated-12/extrabold",children:C.Z.Messages.ENJOY_A_FREE_MONTH})]}):null};var ie=t(794057),le=t(859691),se=t(29005),oe=t(390599),ue=t(792018);function ce(e,n,t){a.useEffect((function(){null!=e&&e!==oe.h8.AWAITING_PURCHASE_TOKEN_AUTH&&n===ue.I.PENDING?t(oe.h8.AWAITING_PURCHASE_TOKEN_AUTH):e===oe.h8.AWAITING_PURCHASE_TOKEN_AUTH&&n===ue.I.SUCCESS&&t(oe.h8.REVIEW)}),[e,n,t])}
var de=t(967543),pe=t(559019),fe=t(916957),Ie=t(720897),_e=t(629590),Ee=t(138402),Se=t(757987),me=t(436035),he=t(95467),ye=t(590483),Te=t(56435),Ne=t(898862),ve=t(554962),Pe=t(511515),be=t(939042),Ae=t(350138),Oe=t(988231),Ce=t(125313),ge=t(279480),Re=t(832010),Me=t(817513),Le=t(146530),xe=t(739093),je=t(461061),Ze=t(736101),Ge=t.n(Ze);function we(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function Ue(e){var n=e.premiumSubscription,t=e.planId,a=e.selectPlan,i=e.selected,s=e.isGift,u=e.priceOptions,c=(0,f.e7)([Me.default],(function(){return Me.default.locale})),d=(0,f.e7)([fe.Z],(function(){return fe.Z.get(t)}));o()(null!=d,"Missing subscriptionPlan");var p=null!=n&&n.planId===t,I=p||t===K.Xh.PREMIUM_MONTH_TIER_2&&null!=n&&[K.Xh.PREMIUM_YEAR_TIER_0,K.Xh.PREMIUM_YEAR_TIER_1].includes(n.planId),_=K.nH[t],E=xe.U.useExperiment({}).enableMonthlyTier0Gifting,S=(0,ye.aS)(t,!1,s,u),m=(0,
ye.Ap)(u.paymentSourceId),h=null!=_&&(!s||t===K.Xh.PREMIUM_YEAR_TIER_0&&E);return(0,r.jsxs)(_e.Z,{role:"radio","aria-checked":i,tabIndex:i?0:-1,focusProps:{offset:{left:-4,right:-4,top:0,bottom:0}},onClick:I?void 0:function(){return a(t)},className:l()(Ge().planOption,we({},Ge().planOptionDisabled,I)),children:[(0,r.jsxs)("div",{className:Ge().planOptionClickable,children:[(0,r.jsx)(Le.Z,{readOnly:!0,displayOnly:!0,value:i,shape:Le.Z.Shapes.ROUND,color:(0,Re.Lq)(je.Ilk.BRAND_500),type:Le.Z.Types.INVERTED,className:Ge().planOptionCheckbox}),(0,r.jsx)("div",{className:l()(Ge().planOptionInterval,we({},Ge().optionSelected,i)),children:(0,ye.L7)(d.interval,s,m,d.intervalCount)}),p?(0,r.jsxs)("span",{className:Ge().planOptionCurrentPlan,children:["(",C.Z.Messages.BILLING_SWITCH_PLAN_CURRENT_PLAN,")"]}):null,d.interval===K.rV.YEAR&&null!=n?(0,r.jsxs)("span",{className:Ge().planOptionMonthsFree,children:["(",C.Z.Messages.BILLING_SWITCH_PLAN_YEARLY_FREE_MONTHS,")"]}):h&&!p?(0,r.jsx)(T.xv,{
tag:"span",variant:"eyebrow",color:"always-white",className:Ge().planOptionDiscount,children:C.Z.Messages.BILLING_PLAN_SELECTION_DISCOUNT.format({discount:(0,Te.T3)(c,_/100)})}):null]}),(0,r.jsx)("div",{className:l()(we({},Ge().optionSelected,i)),children:(0,Te.T4)(S.amount,S.currency)})]})}var ke=t(182102),De=t(609993),Be=t(710431),He=t.n(Be);function Fe(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function We(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function Ye(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))));r.forEach((function(n){We(e,n,t[n])}))}return e}function Ke(e,n){n=null!=n?n:{}
;Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})));t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}));return e}function Ve(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return Fe(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name)
;if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Fe(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,n){var t=C.Z.Messages.BILLING_SWITCH_PLAN_DOWNGRADE_BODY_MONTH,r=C.Z.Messages.BILLING_SWITCH_PLAN_UPGRADE_BODY_TIER_1_YEAR,a=function(){switch(e.interval){case K.rV.YEAR:return t;case K.rV.MONTH:default:return r}}(),i=e.skuId;switch(n){case K.Si.TIER_0:switch(i){case K.Si.TIER_1:return C.Z.Messages.BILLING_SWITCH_PLAN_DOWNGRADE_BODY_TIER_1_TO_TIER_0;case K.Si.TIER_2:return C.Z.Messages.BILLING_SWITCH_PLAN_DOWNGRADE_BODY_TIER_0;default:return a}case K.Si.TIER_1:switch(i){case K.Si.TIER_0:return C.Z.Messages.BILLING_SWITCH_PLAN_UPGRADE_BODY_TIER_1;case K.Si.TIER_2:return C.Z.Messages.BILLING_SWITCH_PLAN_DOWNGRADE_BODY_TIER_1;default:return a}case K.Si.TIER_2:
switch(i){case K.Si.TIER_0:case K.Si.TIER_1:return C.Z.Messages.BILLING_SWITCH_PLAN_UPGRADE_BODY_TIER_2;case K.Si.TIER_2:return e.interval===K.rV.MONTH?C.Z.Messages.BILLING_SWITCH_PLAN_UPGRADE_BODY_TIER_2_YEAR.format({numFreeGuildSubscriptions:K.cb}):a;default:return a}default:return a}}var Qe=a.forwardRef((function(e,n){var t,i=e.isSelected,l=e.giftStyle,s=e.setSelectedGiftStyle,o=e.onFocus,u=e.onBlur,c=Ve(a.useState(!1),2),d=c[0],p=c[1];switch(l){case Ne.Cj.SNOWGLOBE:t=C.Z.Messages.SEASONAL_GIFTING_OPTION_SNOWGLOBE;break;case Ne.Cj.BOX:t=C.Z.Messages.SEASONAL_GIFTING_OPTION_BOX;break;case Ne.Cj.CUP:t=C.Z.Messages.SEASONAL_GIFTING_OPTION_CUP;break;default:t=C.Z.Messages.SEASONAL_GIFTING_CUSTOMIZE_YOUR_GIFT_BOX}var f=(0,Ee.xU)({isSelected:i,label:t});return(0,r.jsx)(_e.Z,Ke(Ye({innerRef:n,className:He().clickable,onClick:function(){return s(l)}},f),{onFocus:o,onBlur:u,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)},children:(0,r.jsx)(ke.Z,{giftStyle:l,
className:i?He().seasonalGiftBoxHighlighted:He().seasonalGiftBox,shouldAnimate:d||i})}))}));function ze(e){var n=e.premiumSubscription,t=e.skuId,i=e.selectedPlanId,l=e.setSelectedPlanId,s=e.isGift,u=void 0!==s&&s,c=e.isSeasonalGift,d=void 0!==c&&c,p=e.selectedGiftStyle,I=e.setSelectedGiftStyle,_=e.priceOptions,E=e.planOptions,S=e.eligibleForMultiMonthPlans,m=(0,N.usePaymentContext)(),h=m.activeSubscription,y=m.setSelectedPlanId,v=m.selectedSkuId,P=m.selectedPlan,b=m.priceOptions;t=null!=t?t:v;n=null!=n?n:h;o()(void 0!==n,"should not be undefined");var A=Ve((0,f.Wu)([fe.Z],(function(){return[null!=n?fe.Z.get(n.planId):null,null!=i?fe.Z.get(i):null]})),2),O=A[0],g=A[1],R=(0,Pe.N)(),M=null==R?void 0:R.subscription_trial,L=null!=g?g:P,x=a.useCallback((function(e){null!=l?l(e):y(e)}),[l,y]),j=null!=_?_:b;o()(null!=j,"Price option has to be set");var Z=null!=R&&K.nG[R.trial_id].skus.includes(t);a.useEffect((function(){S&&V.trackExposure({})}),[S])
;var G=null!=(null==L?void 0:L.id)&&E.includes(L.id);a.useEffect((function(){if(!G)if(null==O||u)x(E[0]);else if(null!=O){var e=E.find((function(e){return e!==O.id}));null!=e&&x(e)}}),[G,u,E,O,x]);a.useEffect((function(){t!==K.Si.TIER_0||u||z.Nx.trackExposure({})}),[t,u]);var w=(u||!Z)&&G,U=(0,Ee.ar)(),k=null!=(null==L?void 0:L.id)?(0,ye.aS)(L.id,!1,u,j):void 0,D="HR"==(0,ve.Z)().ipCountryCode&&null!=k&&k.currency==De.pK.EUR,B=(0,Ee.ar)({orientation:"horizontal"}),H=(0,ye.Ap)(j.paymentSourceId),F=a.useRef(null),W=Ve(a.useState(!1),2),Y=W[0],X=W[1];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Oe.Z,{isGift:u,skuId:t}),(0,r.jsx)(ae,{trialId:null==R?void 0:R.trial_id,isGift:u,plan:g}),(0,r.jsxs)("div",{className:He().stepBody,children:[d?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:He().seasonalGiftBoxHeaderContainer,children:[(0,r.jsx)(T.X6,{variant:"heading-deprecated-12/semibold",className:He().seasonalGiftBoxHeaderText,
children:C.Z.Messages.SEASONAL_GIFTING_CUSTOMIZE_YOUR_GIFT_BOX}),(0,r.jsx)(Se.ZP,{text:C.Z.Messages.SEASONAL_GIFTING_INFO_TOOLTIP,position:Se.ZP.Positions.TOP,children:function(e){return(0,r.jsx)(_e.Z,Ke(Ye({},e),{className:He().infoIconContainer,"aria-label":C.Z.Messages.SEASONAL_GIFTING_INFO_TOOLTIP,children:(0,r.jsx)(me.Z,{className:He().infoIcon})}))}})]}),(0,r.jsxs)("div",Ke(Ye({tabIndex:null!=p||Y?void 0:0,onFocus:function(e){var n;e.target===e.currentTarget&&(null===(n=F.current)||void 0===n||n.focus())},className:He().seasonalGiftBoxOptionContainer,"aria-label":C.Z.Messages.SEASONAL_GIFTING_CUSTOMIZE_YOUR_GIFT_BOX},B),{children:[(0,r.jsx)(Qe,{isSelected:p===Ne.Cj.BOX,giftStyle:Ne.Cj.BOX,setSelectedGiftStyle:I,ref:F,onFocus:function(){return X(!0)},onBlur:function(){return X(!1)}}),(0,r.jsx)(Qe,{isSelected:p===Ne.Cj.SNOWGLOBE,giftStyle:Ne.Cj.SNOWGLOBE,setSelectedGiftStyle:I,onFocus:function(){return X(!0)},onBlur:function(){return X(!1)}}),(0,r.jsx)(Qe,{isSelected:p===Ne.Cj.CUP,
giftStyle:Ne.Cj.CUP,setSelectedGiftStyle:I,onFocus:function(){return X(!0)},onBlur:function(){return X(!1)}})]})),(0,r.jsx)("div",{className:He().selectPlanDivider})]}):null,null==O||u?null:(0,r.jsx)("div",{className:He().bodyText,children:Xe(O,t)}),(0,r.jsx)("div",{className:He().selectPlanChooseTitle,children:C.Z.Messages.BILLING_SWITCH_PLAN_CHOOSE_ONE}),Z&&!u?(0,r.jsx)("div",{className:He().selectPlanChooseSubtitle,children:C.Z.Messages.BILLING_SWITCH_PLAN_CHOOSE_ONE_TRIAL_SUBTITLE_DURATION.format({duration:(0,ye.if)({intervalType:null==M?void 0:M.interval,intervalCount:null==M?void 0:M.interval_count})})}):null,(0,r.jsx)("div",Ke(Ye({},U),{children:E.map((function(e){return(0,r.jsx)(Ue,{planId:e,isGift:u,premiumSubscription:u?null:null!=n?n:null,selectPlan:x,selected:(null==L?void 0:L.id)===e,priceOptions:j},e)}))})),(0,r.jsx)("div",{children:w&&null!=L&&null!=k?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:He().selectPlanDivider}),(0,r.jsx)(be.Ji,{
label:C.Z.Messages.BILLING_PAYMENT_BREAKDOWN_TOTAL,value:(0,r.jsx)(Ae.Z,{price:k.amount,currency:k.currency,intervalType:u?null:L.interval,intervalCount:L.intervalCount,isPrepaidPaymentSource:H}),className:He().selectPlanTotalRow})]}):null}),D&&(0,r.jsx)(pe.Z,{message:C.Z.Messages.LOCALIZED_PRICING_HRK_EURO_WARNING.format({kunaPriceWithCurrency:(0,Te.T4)(7.5345*k.amount,De.pK.HRK)})}),!u&&(0,r.jsx)(pe.Z,{message:C.Z.Messages.BILLING_FINAL_PRICE_MAY_CHANGE.format({documentationLink:he.Z.getArticleURL(je.BhN.LOCALIZED_PRICING)})})]})]})}function Je(e){var n=e.onStepChange,t=e.selectedPlanId,a=e.isGift,i=e.paymentSources,l=e.onBackClick,s=e.showBackButton,o=e.planOptions,u=(0,N.usePaymentContext)(),c=u.paymentSources,d=u.selectedPlan;i=null!=i?i:c;var p=null!=(t=null!=t?t:null==d?void 0:d.id)&&o.includes(t);return(0,r.jsxs)(r.Fragment,{children:[p&&null!=t?(0,r.jsx)(qe,{paymentSources:i,onStepChange:n,selectedPlanId:t,isGift:a}):(0,r.jsx)(b.Co,{disabled:!0,children:C.Z.Messages.SELECT
}),s?(0,r.jsx)(Ce.Z,{onClick:l}):null]})}function qe(e){var n=e.onStepChange,t=e.selectedPlanId,a=e.isGift,i=e.paymentSources,l=(0,f.e7)([Ie.Z],(function(){return Ie.Z.getPremiumTypeSubscription()})),s=(0,ge.H)(t,a).hasEntitlements;return(0,r.jsx)(b.Co,{onClick:function(){null!=l&&null!=l.paymentSourceId||Object.keys(i).length>0||s?n(oe.h8.REVIEW):n(oe.h8.ADD_PAYMENT_STEPS)},children:C.Z.Messages.SELECT})}var $e=t(581643),en=t(203493),nn=t(825503),tn=t(725002),rn=t(272322),an=t(904729),ln=t.n(an);function sn(e,n){return null!=n.paymentSourceId?(0,ye.aS)(e.id,!1,!1,n):(0,ye.CY)(e.id)}function on(e){var n=e.onClick,t=e.priceOptions,a=fe.Z.getForSkuAndInterval(K.Si.TIER_2,K.rV.MONTH),i=fe.Z.getForSkuAndInterval(K.Si.TIER_2,K.rV.YEAR);o()(null!=a&&null!=i,"monthlyPlan and yearlyPlan must be preloaded");var s=sn(a,t),u=sn(i,t);return(0,r.jsxs)(_e.Z,{onClick:n,className:l()(ln().button,ln().tier2),focusProps:{offset:4},children:[(0,r.jsx)("div",{className:ln().tier2Image}),(0,r.jsxs)("div",{
className:ln().description,children:[(0,r.jsx)($e.Z,{className:l()(ln().tierTitle)}),(0,r.jsx)("div",{className:ln().text,children:C.Z.Messages.BILLING_SWITCH_PLAN_TIER_2_DESCRIPTION.format({numFreeGuildSubscriptions:K.cb})})]}),(0,r.jsxs)("div",{className:ln().priceWrapper,children:[(0,r.jsx)(Ae.Z,{price:s.amount,currency:s.currency,intervalType:a.interval,className:ln().price}),(0,r.jsx)(Ae.Z,{price:u.amount,currency:u.currency,intervalType:i.interval,className:ln().price})]})]})}function un(e){var n=e.onClick,t=e.priceOptions,a=fe.Z.getForSkuAndInterval(K.Si.TIER_1,K.rV.MONTH),i=fe.Z.getForSkuAndInterval(K.Si.TIER_1,K.rV.YEAR);o()(null!=a&&null!=i,"monthlyPlan and yearlyPlan must be preloaded");var s=sn(a,t),u=sn(i,t);return(0,r.jsxs)(_e.Z,{onClick:n,className:l()(ln().button,ln().tier1),focusProps:{offset:4},children:[(0,r.jsx)("div",{className:ln().tier1Image}),(0,r.jsxs)("div",{className:ln().description,children:[(0,r.jsx)("div",{children:(0,r.jsx)(en.Z,{})}),(0,r.jsx)(nn.Z,{
className:l()(ln().tierTitle)}),(0,r.jsx)("div",{className:ln().text,children:C.Z.Messages.BILLING_SWITCH_PLAN_TIER_1_DESCRIPTION})]}),(0,r.jsxs)("div",{className:ln().priceWrapper,children:[(0,r.jsx)(Ae.Z,{price:s.amount,currency:s.currency,intervalType:a.interval,className:ln().price}),(0,r.jsx)(Ae.Z,{price:u.amount,currency:u.currency,intervalType:i.interval,className:ln().price})]})]})}function cn(e){var n=e.onClick,t=e.isGift;return(0,r.jsx)(_e.Z,{onClick:n,style:{cursor:"pointer"},children:(0,r.jsx)(rn.wp,{className:ln().tier2MarketingCard,ctaButton:null,showWumpus:!0,showYearlyPrice:!0,isGift:t})})}function dn(e){var n=e.onClick,t=e.isGift;return(0,r.jsx)(_e.Z,{onClick:n,style:{cursor:"pointer"},children:(0,r.jsx)(rn.Gq,{className:ln().tier0MarketingCard,ctaButton:null,showWumpus:!0,showYearlyPrice:!0,isGift:t})})}const pn=function(e){var n=e.onSelectSku,t=e.priceOptions,a=e.isGift,i=z.Ll.useExperiment({},{autoTrackExposure:!0}).enableTier0;return(0,r.jsx)(tn.zJ,{
className:ln().skuButtons,paddingFix:!1,children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(cn,{onClick:function(){return n(K.Si.TIER_2)},isGift:a}),(0,r.jsx)(dn,{onClick:function(){return n(K.Si.TIER_0)},isGift:a})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(on,{priceOptions:t,onClick:function(){return n(K.Si.TIER_2)}}),(0,r.jsx)(un,{priceOptions:t,onClick:function(){return n(K.Si.TIER_1)}})]})})};var fn=t(259083),In=t(677839),_n=t(230903),En=t(711462),Sn=t(238307),mn=t(556137),hn=t(909187),yn=t(655868),Tn=t(154765),Nn=t(893321),vn=t(378564),Pn=t(326440),bn=t(82961),An=t(562181),On=t(862325),Cn=t(212658),gn=t(470352),Rn=t(112508),Mn=t(231492),Ln=t.n(Mn),xn=t(968071),jn=t.n(xn);function Zn(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function Gn(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1
;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return Zn(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zn(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wn(e){
var n,t=e.premiumSubscription,a=e.paymentSources,i=e.priceOptions,l=e.onPaymentSourceChange,s=e.onPaymentSourceAdd,u=e.planId,c=e.setHasAcceptedTerms,d=e.legalTermsNodeRef,p=e.hasLegalTermsFlash,I=e.onInvoiceError,_=e.planGroup,E=e.currencies,S=e.onCurrencyChange,m=e.hasOpenInvoice,h=e.purchaseState,y=i.paymentSourceId,T=(0,f.e7)([fe.Z],(function(){return fe.Z.get(u)}));o()(null!=T,"Missing newPlan");var N,v=(0,f.e7)([Nn.Z],(function(){return Nn.Z.hidePersonalInformation}));N=m?C.Z.Messages.BILLING_PURCHASE_DETAILS_HEADER:(0,ye.PV)(u)?(0,ye.W_)(t,T):C.Z.Messages.BILLING_SELECT_PLAN_GUILD_SUBSCRIPTION.format({planName:T.name});var P=W.M.EEA_COUNTRIES.has(vn.Z.ipCountryCodeWithFallback),b=h===Tn.A.PURCHASING||h===Tn.A.COMPLETED;return(0,r.jsxs)("div",{className:jn().stepBody,children:[(0,r.jsx)(An.vw,{tag:An.RB.H5,children:N}),null!=t?m?(0,r.jsx)(Un,{premiumSubscription:t,onInvoiceError:I,priceOptions:i,preventFetch:!1}):(0,On.R4)(t,u,_)?(0,r.jsx)(kn,{premiumSubscription:t,newPlan:T,
onInvoiceError:I,planGroup:_,priceOptions:i,preventFetch:b}):(0,r.jsx)(Dn,{premiumSubscription:t,newPlan:T,planGroup:_,priceOptions:i,preventFetch:b}):null,(0,r.jsxs)("div",{className:jn().paymentSourceWrapper,children:[(0,r.jsx)(An.vw,{tag:An.RB.H5,children:C.Z.Messages.PAYMENT_SOURCE_PAYMENT_REQUEST_INFO_TITLE}),(0,r.jsx)(hn.Z,{paymentSources:Object.values(a),selectedPaymentSourceId:y,onChange:l,onPaymentSourceAdd:s,hidePersonalInformation:v,disabled:b})]}),(0,r.jsxs)(Sn.b,{currencies:E,className:jn().currencyWrapper,children:[(0,r.jsx)(An.vw,{tag:An.RB.H5,children:C.Z.Messages.PAYMENT_CURRENCY}),(0,r.jsx)(Sn.Z,{selectedCurrency:i.currency,currencies:E,onChange:S,disabled:b})]}),(0,r.jsx)(gn.Z,{isActive:p,ref:d,children:(0,r.jsx)(yn.Z,{onChange:c,finePrint:(0,r.jsx)(mn.Z,{subscriptionPlan:T,paymentSourceType:null===(n=a[null!=y?y:""])||void 0===n?void 0:n.type}),forceShow:!0,showPricingLink:T.currency!==je.pKx.USD,showWithdrawalWaiver:P,disabled:b})})]})}function Un(e){
var n=e.premiumSubscription,t=e.onInvoiceError,i=e.priceOptions,l=e.preventFetch,s=Gn((0,Cn.Ox)({subscriptionId:n.id,preventFetch:l}),2),o=s[0],u=s[1];a.useEffect((function(){t(u)}),[t,u]);var c=(0,ye.Ap)(i.paymentSourceId);return null!=o?(0,r.jsxs)(be.PO,{className:Ln().invoice,children:[(0,r.jsx)(Rn.By,{invoice:o,isPrepaidPaymentSource:c}),(0,r.jsx)(Rn.nd,{premiumSubscription:n,renewalInvoice:o,isUpdate:!0,isPrepaidPaymentSource:c})]}):(0,r.jsx)(bn.Z,{})}function kn(e){var n=e.premiumSubscription,t=e.newPlan,i=e.onInvoiceError,l=e.planGroup,s=e.priceOptions,o=e.preventFetch,u=(0,ye.al)(n,t.id,1,new Set(l)),c=Gn((0,Cn.ED)({subscriptionId:n.id,items:u,renewal:!1,applyEntitlements:!0,paymentSourceId:s.paymentSourceId,currency:s.currency,preventFetch:o}),2),d=c[0],p=c[1],f=Gn((0,Cn.ED)({subscriptionId:n.id,items:u,renewal:!0,paymentSourceId:s.paymentSourceId,currency:s.currency,preventFetch:o}),2),I=f[0],_=f[1],E=null!=p?p:_;a.useEffect((function(){i(E)}),[i,E]);if(null!=E)return(0,
r.jsx)(Pn.Z,{children:E.message});if(null==d||null==I)return(0,r.jsx)(bn.Z,{className:jn().spinner});var S=(0,ye.Ap)(s.paymentSourceId);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Rn.hG,{proratedInvoice:d,renewalInvoice:I}),(0,r.jsxs)(be.PO,{className:jn().invoice,children:[(0,r.jsx)(be.q9,{children:C.Z.Messages.BILLING_SWITCH_PLAN_PURCHASE_DETAILS}),(0,r.jsx)(Rn.Lu,{invoice:d,newPlan:t,isPrepaidPaymentSource:S}),(0,r.jsx)(Rn.nd,{premiumSubscription:n,proratedInvoice:d,renewalInvoice:I,isUpdate:!0,isPrepaidPaymentSource:S})]})]})}function Dn(e){var n,t=e.premiumSubscription,a=e.newPlan,i=e.planGroup,l=e.priceOptions,s=e.preventFetch,o=Gn((0,Cn.ED)({subscriptionId:t.id,items:(0,ye.al)(t,a.id,1,new Set(i)),renewal:!0,applyEntitlements:!1,paymentSourceId:l.paymentSourceId,currency:l.currency,preventFetch:s}),2),u=o[0],c=o[1];if(null!=c)return(0,r.jsx)(Pn.Z,{children:c.message});if(null==u)return(0,r.jsx)("div",{children:(0,r.jsx)(bn.Z,{})});n=t.type===je.NYc.PREMIUM?(0,
ye.Gf)(a.id):a.name;var d=(0,ye.Ap)(l.paymentSourceId);return(0,r.jsxs)("div",{className:jn().bodyText,children:[(0,r.jsx)("div",{className:Ln().renewalInvoiceDate,children:C.Z.Messages.BILLING_SWITCH_PLAN_CHANGE_DATE.format({renewalDate:u.subscriptionPeriodStart})}),(0,r.jsxs)(be.PO,{className:jn().invoice,children:[(0,r.jsx)(be.q9,{children:C.Z.Messages.PREMIUM_SUBSCRIPTION_UPDATES}),(0,r.jsx)(be.R$,{label:n,value:(0,ye.PK)(a,l,!0)}),(0,r.jsx)(be.KU,{}),(0,r.jsx)(Rn.nd,{premiumSubscription:t,renewalInvoice:u,isUpdate:!0,isPrepaidPaymentSource:d})]})]})}var Bn=t(922877),Hn=t(762441),Fn=t(932847),Wn=t(557473),Yn=t(960136),Kn=t(709947),Vn=t(851225),Xn=t(546005),Qn=t(695784),zn=t(343657),Jn=t(727202),qn=t.n(Jn);function $n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function et(e,n,t,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){t(e);return}s.done?n(o):Promise.resolve(o).then(r,a)}function nt(e,n,t){n in e?Object.defineProperty(e,n,{
value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function tt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))));r.forEach((function(n){nt(e,n,t[n])}))}return e}function rt(e,n){n=null!=n?n:{};Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})));t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}));return e}function at(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++){t=i[r]
;n.indexOf(t)>=0||(a[t]=e[t])}return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){t=i[r];n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}}return a}function it(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return $n(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $n(e,n)}(e,n)||function(){
throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var lt=function(e,n){var t,r,a,i,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;(r=0,a)&&(i=[2&i[0],a.value]);switch(i[0]){case 0:case 1:a=i;break;case 4:l.label++;return{value:i[1],done:!1};case 5:l.label++;r=i[1];i=[0];continue;case 7:i=l.ops.pop();l.trys.pop();continue;default:if(!(a=l.trys,a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){
l.label=a[1];a=i;break}if(a&&l.label<a[2]){l.label=a[2];l.ops.push(i);break}a[2]&&l.ops.pop();l.trys.pop();continue}i=n.call(e,l)}catch(e){i=[6,e];r=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},st=[oe.h8.PLAN_SELECT,oe.h8.ADD_PAYMENT_STEPS,oe.h8.REVIEW,oe.h8.CONFIRM];function ot(e,n){return e in n}function ut(e){var n=e.selectSku,t=e.onClose,a=e.priceOptions,i=e.isGift,l=F.Z.getCurrentConfig({}).enabled,s=(0,q.Z)(),o=l&&"PL"==s;return(0,r.jsxs)("div",{className:jn().premiumSkuSelect,children:[(0,r.jsxs)(O.xB,{separator:!1,children:[(0,r.jsx)(An.vw,{tag:An.RB.H4,children:C.Z.Messages.BILLING_STEP_SELECT_PLAN}),(0,r.jsx)(O.ol,{onClick:t})]}),o&&(0,r.jsx)(ie.Z,{fromBoostCancelModal:!1,className:jn().plnNotice}),(0,r.jsx)(pn,{onSelectSku:n,priceOptions:a,isGift:i})]})}function ct(e,n,t,r,a){t(n);var i=oe.h8.PLAN_SELECT,l=(0,ye.k5)(e);l!==K.Si.TIER_1&&l!==K.Si.TIER_2||n!==K.Si.TIER_0||a||(i=oe.h8.WHAT_YOU_LOSE);r(i)}function dt(e){
var n,t=e.isGift,i=void 0!==t&&t,s=e.giftMessage,d=e.subscriptionTier,S=e.initialPlanId,h=e.followupSKUInfo,T=e.transitionState,P=e.onClose,b=e.onComplete,g=e.onSubscriptionConfirmation,R=e.analyticsObject,M=e.analyticsLocation,L=e.analyticsSourceLocation,x=e.analyticsSubscriptionType,j=void 0===x?je.NYc.PREMIUM:x,w=e.trialId,U=e.trialFooterMessageOverride,F=e.postSuccessGuild,W=e.renderHeader,Y=e.renderPurchaseConfirmation,X=e.planGroup,q=void 0===X?K.Y1:X,ee=e.reviewWarningMessage,ne=e.openInvoiceId,te=e.applicationId,re=e.guildId,ae=(0,N.usePaymentContext)(),ie=ae.activeSubscription,se=ae.blockedPayments,ue=(0,f.e7)([$.default],(function(){return $.default.getCurrentUser()})),pe=(0,k.Z)().analyticsLocations,_e=(0,f.e7)([Ie.Z],(function(){return Ie.Z.hasFetchedSubscriptions()})),Ee=(0,f.e7)([fe.Z],(function(){return fe.Z.isFetchingForPremiumSKUs()})),Se=st,me=it(a.useState((function(){return null!=S?oe.h8.REVIEW:null!=d?oe.h8.PLAN_SELECT:oe.h8.SKU_SELECT
})),2),he=me[0],Te=me[1],Ne=it(a.useState((function(){var e,n=null!=S?null===(e=fe.Z.get(S))||void 0===e?void 0:e.skuId:null;return null!=n?n:d})),2),ve=Ne[0],Pe=Ne[1],be=it(a.useState(S),2),Ae=be[0],Oe=be[1],Ce=(0,f.e7)([fe.Z],(function(){return null!=Ae?fe.Z.get(Ae):null})),Re=(0,f.e7)([Bn.Z],(function(){return Bn.Z.applicationIdsFetched.has(K.RQ)})),Me=it(a.useState(!1),2),Le=Me[0],xe=Me[1],Ze=a.useMemo((function(){var e,n=null==Ce||Object.values(K.Si).includes(null==Ce?void 0:Ce.skuId);if(n)e=Object.values(K.Si);else{e=[Ce.skuId];null!=ie&&(0,On.yb)(ie).forEach((function(n){e.includes(n)||e.push(n)}))}return{skuIDs:e,isPremiumSKU:n}}),[ie,Ce]),Ge=(0,D.V)(Ze.skuIDs),we=it(a.useState(Tn.A.WAITING),2),Ue=we[0],Be=we[1],He=it(a.useState(!1),2),Fe=He[0],We=He[1],Ye=it(a.useState(null),2),Ke=Ye[0],Ve=Ye[1],Xe=a.useRef(null),Qe=it((0,G.Z)(!1,500),2),qe=Qe[0],$e=Qe[1];(0,ge.w)(ie,(function(){return P(!1)}),i);var en=a.useRef(null!=ie?ie.planId:null);a.useEffect((function(){
null==en.current&&null!=ie&&(en.current=ie.planId)}),[ie]);var nn=it((0,u.Z)((function(){return[p().v4(),Date.now()]})),2),tn=nn[0],rn=nn[1],an=null==w||Ze.isPremiumSKU&&!K.nG[w].skus.includes(ve)?null:w,ln={load_id:tn,payment_type:"subscription",location:null!=M?M:R,source:L,subscription_type:j,subscription_plan_id:null==Ce?void 0:Ce.id,price:null==Ce?void 0:Ce.price,regular_price:null==Ce?void 0:Ce.price,currency:null==Ce?void 0:Ce.currency,is_gift:i,eligible_for_trial:null!=w,application_id:te,location_stack:pe,sku_id:ve,guild_id:re,payment_modal_version:"v0"};a.useEffect((function(){_e||(0,_.jg)()}),[_e]);a.useEffect((function(){Re||(0,E.yD)(K.RQ);Ze.isPremiumSKU&&I.Z.wait((function(){return(0,m.Y2)()}));Fn.default.track(je.rMx.PAYMENT_FLOW_STARTED,ln)}),[]);var sn=(0,
de.fL)(i||null==ie?void 0:ie.paymentSourceId),on=sn.paymentSourceId,un=sn.paymentSources,cn=sn.setPurchaseError,dn=sn.paymentAuthenticationState,pn=sn.setPaymentSourceId,Sn=sn.paymentError,mn=sn.purchaseError,hn=sn.purchaseErrorBlockRef,yn=sn.purchaseTokenAuthState,Nn=a.useRef(on),vn=null!=un&&null!=on?null===(n=un[on])||void 0===n?void 0:n.country:null,Pn=a.useRef(vn);a.useEffect((function(){if(!(0,ye.Z8)()){var e,n=null!=on?null===(e=un[on])||void 0===e?void 0:e.country:"",t=Pn.current!==n&&Nn.current!==on;Ze.isPremiumSKU&&(!Ge&&!Ee||t)&&I.Z.wait((function(){return(0,m.Y2)(void 0,on)}));Nn.current=on;Pn.current=n}}),[Re,Ge,on,un,Ee,Ze.isPremiumSKU]);var bn=(0,c.Z)((function(){return Date.now()}),[he]),An=function(e,n){e===oe.h8.CONFIRM&&(null==b||b());Te(e);cn(null);var t=Date.now();Fn.default.track(je.rMx.PAYMENT_FLOW_STEP,rt(tt({},ln),{from_step:null!=n?n:he,to_step:e===oe.h8.ADD_PAYMENT_STEPS?oe.h8.PAYMENT_TYPE:e,step_duration_ms:t-bn,flow_duration_ms:t-rn}))};(0,le.bp)(he,dn,An)
;(0,oe.dZ)(he,Ue,Be);ce(he,yn,An);var Cn=function(){null==P||P(Ue===Tn.A.COMPLETED)};(0,H.Z)(Cn);var gn,Rn=it(a.useState(),2),Mn=Rn[0],Ln=Rn[1],xn=null!=Ce?Ce:fe.Z.get(K.Xh.PREMIUM_MONTH_TIER_2),Zn=[];null!=xn&&(Zn=(0,Wn.DE)(xn.id,on,i));gn=null!=ie&&Zn.includes(ie.currency)?ie.currency:Zn.length>0?Zn[0]:De.pK.USD;var Gn=(0,Wn.gr)(gn,null==xn?void 0:xn.id,on,i,Ze.skuIDs),Un=Gn.priceOptions,kn=Gn.setCurrency,Dn=Gn.currencyLoading,Yn=(0,de.vP)({paymentModalArgs:sn,initialStep:oe.h8.PAYMENT_TYPE,prependSteps:[oe.h8.PLAN_SELECT],appendSteps:[oe.h8.REVIEW,oe.h8.CONFIRM],breadcrumpSteps:Se,currentBreadcrumpStep:he,onReturn:function(){var e=Object.values(un).length<1&&null==S?oe.h8.PLAN_SELECT:oe.h8.REVIEW;An(e,oe.h8.PAYMENT_TYPE)},onComplete:function(e){An(oe.h8.REVIEW,e)},onStepChange:function(e){var n=e.currentStep,t=e.toStep,r=Date.now();Fn.default.track(je.rMx.PAYMENT_FLOW_STEP,rt(tt({},ln),{from_step:n,to_step:t,step_duration_ms:r-bn,flow_duration_ms:r-rn}))},isGift:i,selectedSkuId:ve
}),Kn=V.useExperiment({}).newPlans,Xn=null!=on?un[on]:null,Qn=!i&&null!=ve&&ve===K.Si.TIER_2&&null!=ue&&ue.hasHadPremium()&&_e&&null==ie&&Q(Xn),zn=z.Ll.useExperiment({}).enableTier0,Jn=a.useMemo((function(){if(null==ve||!Ze.isPremiumSKU)return[];var e=(0,ye.V7)(ve,Qn?Kn:[],ie,i);return zn&&ve===K.Si.TIER_1?e.filter((function(e){return e!==K.Xh.PREMIUM_YEAR_TIER_1})):e}),[Kn,ve,ie,Ze.isPremiumSKU,Qn,zn,i]),$n=null!=Ae&&K.o4.has(Ae)&&null!=Xn&&!Q(Xn)?new Error(C.Z.Messages.BILLING_ERROR_INVALID_PLAN_FOR_PAYMENT_SOURCE):null,et=it(a.useState((0,Vn.Em)(w,on,null==Ce?void 0:Ce.skuId)),1)[0],at=it(a.useState((0,Vn.sE)(w,on,null==Ce?void 0:Ce.skuId)),1)[0];a.useEffect((function(){et&&Vn.ZP.trackExposure({});if(at){Te(oe.h8.REVIEW);Oe(K.Xh.PREMIUM_MONTH_TIER_2)}}),[et,at]);var lt=Ue!==Tn.A.PURCHASING&&(!_e||!Ge||Dn||!Zn.includes(Un.currency)),dt=Ue===Tn.A.PURCHASING&&ve===K.Si.TIER_0,pt=null==Ae||(0,ye.PV)(Ae),ft=J.ZP.useExperiment({}).enabled,It=(0,J.rK)();a.useEffect((function(){
It&&i&&J.ZP.trackExposure({})}),[It,i]);var Et,St=ft&&It&&i&&ve===K.Si.TIER_2;if(se)Et=(0,r.jsx)(B.Vq,{});else if(lt||dt)Et=(0,r.jsx)(_t,{});else{null==on&&null!=ie&&null!=ie.paymentSourceId&&pn(ie.paymentSourceId);switch(he){case oe.h8.SKU_SELECT:Et=(0,r.jsx)(ut,{selectSku:function(e){return ct(ie,e,Pe,An,i)},onClose:Cn,priceOptions:Un,isGift:i});break;case oe.h8.WHAT_YOU_LOSE:Et=(0,r.jsx)(mt,{handleStepChange:An,handleClose:Cn});break;case oe.h8.PLAN_SELECT:o()(null!=ve,"Expected planId");Et=(0,r.jsx)(v.Z,{steps:Se,isGift:i,isSeasonalGift:St,giftMessage:s,currentStep:he,paymentError:Sn,body:(0,r.jsx)(ze,{premiumSubscription:null!=ie?ie:null,skuId:ve,selectedPlanId:Ae,setSelectedPlanId:Oe,isGift:i,isSeasonalGift:St,selectedGiftStyle:Mn,setSelectedGiftStyle:Ln,priceOptions:Un,planOptions:Jn,eligibleForMultiMonthPlans:Qn}),footer:(0,r.jsx)(O.mz,{justify:A.Z.Justify.BETWEEN,align:A.Z.Align.CENTER,children:(0,r.jsx)(Je,{paymentSources:un,onStepChange:An,selectedPlanId:Ae,isGift:i,
onBackClick:function(){return An(oe.h8.SKU_SELECT)},showBackButton:null==S&&null==d,planOptions:Jn})})});break;case oe.h8.ADD_PAYMENT_STEPS:Et=Yn;break;case oe.h8.AWAITING_PURCHASE_TOKEN_AUTH:Et=Z({steps:Se,currentStep:he,paymentError:sn.paymentError,className:qn().body,isEmailResent:Le,setIsEmailResent:xe});break;case oe.h8.AWAITING_AUTHENTICATION:Et=(0,r.jsx)(y.b,{steps:Se,currentStep:he,paymentError:sn.paymentError,className:jn().awaitingAuthenticationStep});break;case oe.h8.REVIEW:o()(null!=Ae,"Expected planId");Et=(0,r.jsx)(v.Z,{steps:Se,currentStep:he,paymentError:Sn,purchaseError:mn,purchaseErrorBlockRef:hn,planError:$n,hideBreadcrumbs:at,hasCurrencies:Zn.length>1,body:null==ie||i?(0,r.jsx)(_n.Z,{selectedPlanId:Ae,isGift:i,paymentSources:un,onPaymentSourceChange:function(e){return pn(null!=e?e.id:null)},priceOptions:Un,currencies:Zn,onCurrencyChange:function(e){return kn(e)},handlePaymentSourceAdd:function(){return An(oe.h8.ADD_PAYMENT_STEPS)},setHasAcceptedTerms:We,
legalTermsNodeRef:Xe,hasLegalTermsFlash:qe,trialId:an,trialFooterMessageOverride:U,reviewWarningMessage:ee,purchaseState:Ue}):(0,r.jsx)(wn,{premiumSubscription:ie,paymentSources:un,priceOptions:Un,onPaymentSourceChange:function(e){pn(null!=e?e.id:null)},onPaymentSourceAdd:function(){An(oe.h8.ADD_PAYMENT_STEPS);pn(null)},planId:Ae,setHasAcceptedTerms:We,legalTermsNodeRef:Xe,hasLegalTermsFlash:qe,onInvoiceError:function(e){return Ve(e)},planGroup:q,currencies:Zn,onCurrencyChange:function(e){return kn(e)},hasOpenInvoice:null!=ne,purchaseState:Ue}),footer:(0,r.jsx)(En.Z,{premiumSubscription:null!=ie?ie:null,planId:Ae,setHasAcceptedTerms:We,hasAcceptedTerms:Fe,priceOptions:Un,setPurchaseState:Be,onBack:function(){return An(oe.h8.PLAN_SELECT)},onNext:function(){return An(oe.h8.CONFIRM)},onPurchaseError:function(e){return cn(e)},legalTermsNodeRef:Xe,flashLegalTerms:function(){return $e(!0)},invoiceError:Ke,planError:$n,analyticsLocation:M,baseAnalyticsData:ln,flowStartTime:rn,isGift:i,
giftStyle:Mn,trialId:an,planGroup:q,purchaseTokenAuthState:yn,openInvoiceId:ne,backButtonEligible:pt})});break;case oe.h8.CONFIRM:o()(null!=Ae,"Expected planId");o()(null!=ve,"Expected selectedSkuId");o()(null!=Ce,"Expected subscriptionPlan");var ht,yt=function(){Cn();null==g||g()};if(null!=Y)ht=Y(Ce,yt);else if(i)ht=(0,r.jsx)(In.T,{planId:Ae,selectedGiftStyle:Mn,onClose:yt});else if(en.current===Ae){var Tt;ht=(0,r.jsx)(In.Z,{planId:Ae,enableNoPaymentTrial:at,postSuccessGuild:F,onClose:yt,paymentSourceType:null===(Tt=un[null!=on?on:""])||void 0===Tt?void 0:Tt.type})}else{var Nt;ht=(0,r.jsx)(In.Z,{followupSKUInfo:h,enableNoPaymentTrial:at,startingPremiumSubscriptionPlanId:en.current,planId:Ae,onClose:yt,isDowngrade:null!=ie&&(0,On.GY)(ie,Ae,q),paymentSourceType:null===(Nt=un[null!=on?on:""])||void 0===Nt?void 0:Nt.type})}Et=(0,r.jsx)(v.Z,{steps:Se,currentStep:he,body:ht,hideBreadcrumbs:!0});break;default:throw new Error("Unexpected step ".concat(he))}}var vt=null
;if(se)vt=null;else if(null!=W){o()(null!=Ce,"Expected subscriptionPlan");vt=W(Ce,Cn,he)}else if(he!==oe.h8.SKU_SELECT&&he!==oe.h8.WHAT_YOU_LOSE&&null!=ve){o()(ot(ve,K.y7),"invalid sku id: ".concat(ve));vt=he===oe.h8.CONFIRM&&i&&St&&null!=Mn?(0,r.jsx)(ke.Z,{giftStyle:Mn,className:jn().seasonalGiftBoxHeaderIcon}):(0,r.jsx)(fn.Z,{currentStep:he,purchaseState:Ue,premiumType:K.y7[ve],onClose:Cn,useWinterTheme:St})}return(0,r.jsx)(Hn.Z,{className:jn().shaker,isShaking:pt&&Ue===Tn.A.PURCHASING,intensity:2,children:(0,r.jsxs)(O.Y0,{className:l()(jn().root,nt({},jn().withHeader,null!=vt)),transitionState:T,children:[vt,Et]})})}function pt(){var e,n,t=it(a.useState(!1),2),i=t[0],l=t[1],s=(n=(e=function(){return lt(this,(function(e){switch(e.label){case 0:l(!0);return[4,(0,S.xA)()];case 1:e.sent();return[2]}}))},function(){var n=this,t=arguments;return new Promise((function(r,a){var i=e.apply(n,t);function l(e){et(i,r,a,l,s,"next",e)}function s(e){et(i,r,a,l,s,"throw",e)}l(void 0)}))}),
function(){return n.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Yn.Z,{}),(0,r.jsx)(Kn.C3,{children:(0,r.jsx)(x,{className:qn().body,isEmailResent:i,resendEmail:s})}),(0,r.jsx)(Kn.O3,{children:(0,r.jsx)(j,{})})]})}function ft(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Yn.Z,{}),(0,r.jsx)(Kn.C3,{children:(0,r.jsx)(y.F,{className:jn().awaitingAuthenticationStep})})]})}var It=[{key:null,renderStep:function(e){return(0,r.jsx)(Et,tt({},e))}},{key:oe.h8.SKU_SELECT,renderStep:function(e){return(0,r.jsx)(St,tt({},e))},options:{renderHeader:!1,hideSlider:!0}},{key:oe.h8.WHAT_YOU_LOSE,renderStep:function(e){return(0,r.jsx)(mt,tt({},e))},options:{renderHeader:!1,hideSlider:!0}},{key:oe.h8.PLAN_SELECT,renderStep:function(e){return(0,r.jsx)(yt,tt({},e))},options:{renderHeader:!0,breadcrumb:function(){return C.Z.Messages.BILLING_STEP_SELECT_PLAN}}},{key:oe.h8.ADD_PAYMENT_STEPS,renderStep:function(e){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(Qn.v,rt(tt({},e),{
breadcrumbSteps:st}))})},options:{renderHeader:!0,breadcrumb:function(){return C.Z.Messages.BILLING_STEP_PAYMENT}}},{key:oe.h8.AWAITING_PURCHASE_TOKEN_AUTH,renderStep:function(){return(0,r.jsx)(pt,{})}},{key:oe.h8.AWAITING_AUTHENTICATION,renderStep:function(){return(0,r.jsx)(ft,{})}},{key:oe.h8.REVIEW,renderStep:function(e){return(0,r.jsx)(Tt,tt({},e))},options:{renderHeader:!0,breadcrumb:function(){return C.Z.Messages.BILLING_STEP_REVIEW}}},{key:oe.h8.CONFIRM,renderStep:function(e){return(0,r.jsx)(Nt,tt({},e))}}];function _t(){return(0,r.jsx)(bn.Z,{className:jn().spinner})}function Et(e){var n=e.subscriptionTier,t=e.initialPlanId,i=e.setAnalyticsData,l=(0,N.usePaymentContext)(),s=l.blockedPayments,o=l.setStep,u=l.hasFetchedSubscriptions,c=l.hasFetchedSubscriptionPlans,d=l.currencyLoading,p=l.selectedSkuId,I=l.setSelectedSkuId,_=l.selectedPlan,S=l.setSelectedPlanId,m=l.priceOptions,h=l.isGift,y=it(a.useState(!u||!c||d),2),T=y[0],v=y[1],P=(0,f.e7)([Bn.Z],(function(){
return Bn.Z.applicationIdsFetched.has(K.RQ)}));a.useEffect((function(){v(!u||!c||d)}),[d,c,u]);a.useEffect((function(){S(t);P||(0,E.yD)(K.RQ);if(!T&&!s){i((function(e){var n=null!=_?(0,ye.aS)(_.id,!1,h,m):void 0,t=rt(tt({},e),{subscription_plan_id:null==_?void 0:_.id,price:null==n?void 0:n.amount,regular_price:null==_?void 0:_.price,currency:m.currency});Fn.default.track(je.rMx.PAYMENT_FLOW_STARTED,t);return t}));if(null!=t){var e;I(null===(e=fe.Z.get(t))||void 0===e?void 0:e.skuId);o(oe.h8.REVIEW)}else if(null!=n){I(n);o(oe.h8.PLAN_SELECT)}else o(oe.h8.SKU_SELECT)}}),[s,P,t,h,T,m,_,p,i,S,I,o,n]);return T?(0,r.jsx)(_t,{}):s?(0,r.jsx)(B.Vq,{}):null}function St(e){var n=e.handleStepChange,t=e.handleClose,a=(0,N.usePaymentContext)(),i=a.priceOptions,l=a.setSelectedSkuId,s=a.activeSubscription,o=a.isGift;return(0,r.jsx)(ut,{selectSku:function(e){return ct(s,e,l,n,o)},onClose:t,priceOptions:i,isGift:o})}function mt(e){var n=e.handleStepChange,t=e.handleClose,a=(0,w.ZP)(),i=(0,
N.usePaymentContext)().activeSubscription,l=null!=i?(0,ye.Af)(i):null,s=null!=l?(0,ye.gq)(l.planId):null,u=null!=l?(0,ye.Rd)(l.planId):null;o()(null!=u,"Expected premium type");return(0,r.jsx)(se.Z,{premiumType:u,titleText:C.Z.Messages.PREMIUM_DOWNGRADE_WHAT_YOU_LOSE_TITLE,subtitleText:C.Z.Messages.PREMIUM_DOWNGRADE_WHAT_YOU_LOSE_SUBTITLE.format({subscriptionName:s}),footer:(0,r.jsxs)("div",{className:jn().whatYouLoseButtonContainer,children:[(0,r.jsx)(b.Co,{onClick:function(){return n(oe.h8.PLAN_SELECT)},children:C.Z.Messages.CONTINUE}),(0,r.jsx)(b.Co,{look:b.Co.Looks.LINK,color:a===De.BR.DARK?b.Co.Colors.WHITE:b.Co.Colors.PRIMARY,onClick:t,children:C.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_BACK})]}),onClose:t,isDowngrade:!0})}function ht(e){var n=e.giftMessage,t=void 0===n?C.Z.Messages.PREMIUM_PAYMENT_IS_GIFT:n;return!1===(0,N.usePaymentContext)().isGift?null:(0,r.jsx)(h.Z,{className:jn().paymentNote,iconSize:h.Z.Sizes.SMALL,icon:ee.Z,
color:null==t?h.Z.Colors.PRIMARY:h.Z.Colors.SECONDARY,children:t})}function yt(e){var n=e.giftMessage,t=e.selectedGiftStyle,i=e.setSelectedGiftStyle,l=e.handleStepChange,s=e.isPremium,u=e.initialPlanId,c=e.subscriptionTier,d=e.trialId,p=(0,N.usePaymentContext)(),I=p.activeSubscription,_=p.hasFetchedSubscriptions,E=p.isGift,S=p.paymentSourceId,m=p.paymentSources,h=p.selectedSkuId,y=p.selectedPlan,T=p.step,v=J.ZP.useExperiment({}).enabled,P=(0,J.rK)();a.useEffect((function(){P&&E&&J.ZP.trackExposure({})}),[P,E]);var b=v&&P&&E&&h===K.Si.TIER_2,C=null!=S?m[S]:null,g=V.useExperiment({}).newPlans,R=(0,f.e7)([$.default],(function(){return $.default.getCurrentUser()})),M=!E&&null!=h&&h===K.Si.TIER_2&&null!=R&&R.hasHadPremium()&&_&&null==I&&Q(C),L=a.useMemo((function(){return null!=h&&s?(0,ye.V7)(h,M?g:[],I,E):[]}),[h,s,g,I,M,E]),x=null==u&&null==c;o()(null!=T,"Step should be set");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ht,{giftMessage:n}),(0,r.jsx)(Yn.Z,{}),(0,r.jsxs)(Kn.C3,{
children:[(0,r.jsx)(ae,{trialId:d,isGift:E,plan:y}),(0,r.jsx)(zn.Z,{}),(0,r.jsx)(ze,{isGift:E,selectedGiftStyle:t,setSelectedGiftStyle:i,planOptions:L,eligibleForMultiMonthPlans:M,isSeasonalGift:b})]}),(0,r.jsx)(Kn.O3,{children:(0,r.jsx)(O.mz,{justify:A.Z.Justify.BETWEEN,align:A.Z.Align.CENTER,children:(0,r.jsx)(Je,{onStepChange:l,isGift:E,onBackClick:function(){return l(oe.h8.SKU_SELECT)},showBackButton:x,planOptions:L})})})]})}function Tt(e){var n=e.handleStepChange,t=e.trialId,i=e.trialFooterMessageOverride,l=e.reviewWarningMessage,s=e.planGroup,u=e.openInvoiceId,c=e.analyticsData,d=e.selectedGiftStyle,p=e.analyticsLocation,f=e.isPremium,I=e.giftMessage,_=(0,
N.usePaymentContext)(),E=_.activeSubscription,S=_.setUpdatedSubscription,m=_.contextMetadata,h=_.currencies,y=_.isGift,T=_.paymentSourceId,v=_.paymentSources,P=_.priceOptions,b=_.purchaseError,A=_.purchaseTokenAuthState,O=_.selectedPlan,g=_.selectedSkuId,R=_.setCurrency,M=_.setPaymentSourceId,L=_.setPurchaseState,x=_.setPurchaseError,j=_.step,Z=_.purchaseState;o()(null!=O,"Expected plan to be selected");o()(null!=j,"Step should be set");var w=a.useRef(null),U=it((0,G.Z)(!1,500),2),k=U[0],D=U[1],B=it(a.useState(!1),2),H=B[0],F=B[1],W=null==t||f&&!K.nG[t].skus.includes(g)?null:t;a.useEffect((function(){null!=b&&null!=w.current&&w.current.scrollIntoView({behavior:"smooth"})}),[b]);var Y=a.useCallback((function(e){S(e);n(oe.h8.CONFIRM)}),[n,S]),V=null!=T?v[T]:null,X=null!=O&&K.o4.has(O.id)&&null!=V&&!Q(V)?new Error(C.Z.Messages.BILLING_ERROR_INVALID_PLAN_FOR_PAYMENT_SOURCE):null,z=a.useRef(null),J=it(a.useState(null),2),q=J[0],$=J[1];return Z===Tn.A.PURCHASING&&g===K.Si.TIER_0?(0,
r.jsx)(_t,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ht,{giftMessage:I}),(0,r.jsx)(Yn.Z,{}),(0,r.jsxs)(Kn.C3,{children:[(0,r.jsx)(zn.Z,{}),null==E||y?(0,r.jsx)(_n.Z,{selectedPlanId:O.id,isGift:y,paymentSources:v,onPaymentSourceChange:function(e){return M(null!=e?e.id:null)},priceOptions:P,currencies:h,onCurrencyChange:function(e){return R(e)},handlePaymentSourceAdd:function(){return n(oe.h8.ADD_PAYMENT_STEPS)},setHasAcceptedTerms:F,legalTermsNodeRef:z,hasLegalTermsFlash:k,trialId:W,trialFooterMessageOverride:i,reviewWarningMessage:l,purchaseState:Z}):(0,r.jsx)(wn,{premiumSubscription:E,paymentSources:v,priceOptions:P,onPaymentSourceChange:function(e){M(null!=e?e.id:null)},onPaymentSourceAdd:function(){n(oe.h8.ADD_PAYMENT_STEPS);M(null)},planId:O.id,setHasAcceptedTerms:F,legalTermsNodeRef:z,hasLegalTermsFlash:k,onInvoiceError:function(e){return $(e)},planGroup:s,currencies:h,onCurrencyChange:function(e){return R(e)},hasOpenInvoice:null!=u,purchaseState:Z})]}),(0,r.jsx)(Kn.O3,{
children:(0,r.jsx)(En.Z,{premiumSubscription:null!=E?E:null,planId:O.id,setHasAcceptedTerms:F,hasAcceptedTerms:H,priceOptions:P,setPurchaseState:L,onBack:function(){return n(oe.h8.PLAN_SELECT)},onNext:Y,onPurchaseError:function(e){return x(e)},legalTermsNodeRef:z,flashLegalTerms:function(){return D(!0)},invoiceError:q,planError:X,analyticsLocation:p,baseAnalyticsData:c,flowStartTime:m.startTime,isGift:y,giftStyle:d,trialId:W,planGroup:s,purchaseTokenAuthState:A,openInvoiceId:u,backButtonEligible:f})})]})}function Nt(e){var n,t=e.handleClose,a=e.planGroup,i=e.selectedGiftStyle,l=e.onSubscriptionConfirmation,s=e.renderPurchaseConfirmation,u=e.startingPremiumSubscriptionPlanIdRef,c=e.postSuccessGuild,d=e.followupSKUInfo,p=(0,N.usePaymentContext)(),f=p.activeSubscription,I=p.isGift,_=p.paymentSources,E=p.paymentSourceId,S=p.selectedPlan,m=p.selectedSkuId,h=p.step,y=p.updatedSubscription;o()(null!=S,"Expected plan to selected");o()(null!=m,"Expected selectedSkuId")
;o()(null!=h,"Step should be set");var T=function(){t();null==l||l()};if(null!=s)n=s(S,T,y);else if(I)n=(0,r.jsx)(In.T,{planId:S.id,selectedGiftStyle:i,onClose:T});else if(u.current===S.id){var v;n=(0,r.jsx)(In.Z,{planId:S.id,postSuccessGuild:c,onClose:T,paymentSourceType:null===(v=_[null!=E?E:""])||void 0===v?void 0:v.type})}else{var P;n=(0,r.jsx)(In.Z,{followupSKUInfo:d,startingPremiumSubscriptionPlanId:u.current,planId:S.id,onClose:T,isDowngrade:null!=f&&(0,On.GY)(f,S.id,a),paymentSourceType:null===(P=_[null!=E?E:""])||void 0===P?void 0:P.type})}return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(Kn.C3,{children:[(0,r.jsx)(zn.Z,{}),n]})})}function vt(e){var n=e.forceNewPaymentModal,t=at(e,["forceNewPaymentModal"]),i=Xn.Z.useExperiment({}).newModal;a.useEffect((function(){n||Xn.Z.trackExposure({})}),[n]);return n||i?function(e){
var n=e.analyticsLocation,t=e.analyticsObject,i=e.analyticsSourceLocation,s=e.analyticsSubscriptionType,u=void 0===s?je.NYc.PREMIUM:s,d=e.onComplete,p=e.transitionState,I=e.initialPlanId,_=e.giftMessage,E=e.subscriptionTier,S=e.onClose,m=e.trialId,h=e.isGift,y=void 0!==h&&h,T=e.trialFooterMessageOverride,v=e.reviewWarningMessage,P=e.planGroup,b=void 0===P?K.Y1:P,A=e.openInvoiceId,C=e.onSubscriptionConfirmation,g=e.renderPurchaseConfirmation,R=e.postSuccessGuild,M=e.followupSKUInfo,L=e.renderHeader,x=e.applicationId,j=e.guildId,Z=(0,N.usePaymentContext)(),G=Z.purchaseState,w=Z.setPurchaseState,U=Z.selectedSkuId,D=Z.selectedPlan,B=Z.setStep,F=Z.setPurchaseError,W=Z.paymentAuthenticationState,Y=Z.step,V=Z.contextMetadata,X=Z.purchaseTokenAuthState,Q=Z.activeSubscription,z=(0,k.Z)().analyticsLocations,q=it(a.useState({load_id:V.loadId,payment_type:"subscription",location:null!=n?n:t,source:i,subscription_type:u,subscription_plan_id:null==D?void 0:D.id,is_gift:y,eligible_for_trial:null!=m,
location_stack:z,sku_id:E,application_id:x,guild_id:j,payment_modal_version:"v1"}),2),ee=q[0],ne=q[1],te=a.useMemo((function(){return null==D||(0,ye.PV)(D.id)}),[D]),re=it(a.useState(),2),ae=re[0],ie=re[1],se=(0,c.Z)((function(){return Date.now()}),[Y]),ue=a.useCallback((function(e,n){e===oe.h8.CONFIRM&&(null==d||d());B(e);F(null);var t=Date.now();Fn.default.track(je.rMx.PAYMENT_FLOW_STEP,rt(tt({},ee),{from_step:null!=n?n:Y,to_step:e===oe.h8.ADD_PAYMENT_STEPS?oe.h8.PAYMENT_TYPE:e,step_duration_ms:t-se,flow_duration_ms:t-V.startTime}))}),[ee,V.startTime,d,F,B,Y,se]),de=a.useMemo((function(){return function(){return null==S?void 0:S(G===Tn.A.COMPLETED)}}),[S,G]);(0,le.bp)(Y,W,ue);(0,oe.dZ)(Y,G,w);ce(Y,X,ue);(0,H.Z)(de);(0,ge.w)(Q,(function(){return S(!1)}),y);var pe=a.useRef(null!=Q?Q.planId:null);a.useEffect((function(){null==pe.current&&null!=Q&&(pe.current=Q.planId)}),[Q]);var fe={initialPlanId:I,isPremium:te,giftMessage:_,selectedGiftStyle:ae,setSelectedGiftStyle:ie,
subscriptionTier:E,handleStepChange:ue,handleClose:de,analyticsData:ee,setAnalyticsData:ne,trialId:m,trialFooterMessageOverride:T,reviewWarningMessage:v,planGroup:b,openInvoiceId:A,analyticsLocation:n,onSubscriptionConfirmation:C,renderPurchaseConfirmation:g,postSuccessGuild:R,followupSKUInfo:M,startingPremiumSubscriptionPlanIdRef:pe},Ie=J.ZP.useExperiment({}).enabled,_e=(0,J.rK)();a.useEffect((function(){_e&&y&&J.ZP.trackExposure({})}),[_e,y]);var Ee,Se=Ie&&_e&&y&&U===K.Si.TIER_2,me=a.useMemo((function(){var e=null;if(Se&&Y===oe.h8.CONFIRM&&null!=ae)e=(0,r.jsx)(ke.Z,{giftStyle:ae,className:jn().seasonalGiftBoxHeaderIcon});else if(null!=L&&null!=D&&null!=Y)e=L(D,de,Y);else if(Y!==oe.h8.SKU_SELECT&&null!=U){o()(ot(U,K.y7),"invalid sku id: ".concat(U));e=(0,r.jsx)(fn.Z,{currentStep:null!=Y?Y:void 0,purchaseState:G,premiumType:K.y7[U],onClose:de,useWinterTheme:Se})}return e}),[Se,ae,de,G,L,D,U,Y]),he=(0,f.e7)([$.default],(function(){var e
;return null!==(Ee=null===(e=$.default.getCurrentUser())||void 0===e?void 0:e.isStaff())&&void 0!==Ee&&Ee}));return(0,r.jsx)(Hn.Z,{className:jn().shaker,isShaking:te&&G===Tn.A.PURCHASING,intensity:2,children:(0,r.jsx)(O.Y0,{className:l()(jn().root,nt({},jn().withHeader,null!=me),nt({},jn().staffBorder,he)),transitionState:p,children:(0,r.jsx)(Kn.ZP,tt({header:me},fe))})})}(t):dt(t)}function Pt(e){var n=(0,f.e7)([Ie.Z],(function(){return Ie.Z.getPremiumTypeSubscription()})),t=(0,k.Z)(e.analyticsLocations,U.Z.PREMIUM_PAYMENT_MODAL).AnalyticsLocationProvider,a=e.subscriptionTier,i=e.isGift;if(null!=a&&!Object.values(K.Si).includes(a))throw new Error("subscriptionTier must be a premium subscription");return(0,r.jsx)(t,{children:(0,r.jsx)(N.PaymentContextProvider,{activeSubscription:n,stepConfigs:It,skuIDs:K.YQ,isGift:i,children:(0,r.jsx)(vt,tt({},e))})})}},794057:(e,n,t)=>{t.d(n,{Z:()=>p});var r=t(785893),a=(t(667294),
t(294184)),i=t.n(a),l=t(81951),s=t(95467),o=t(461061),u=t(959797),c=t(516178),d=t.n(c);const p=function(e){var n=e.fromBoostCancelModal,t=e.className;return(0,r.jsxs)("div",{className:i()(d().noticeRoot,t),children:[(0,r.jsx)("div",{className:d().iconContainer,children:(0,r.jsx)(l.Z,{className:d().infoIcon})}),(0,r.jsx)("div",{className:d().text,children:(n?u.Z.Messages.LOCALIZED_PRICING_PLN_LEGACY_PRICING_BOOST_WARNING:u.Z.Messages.LOCALIZED_PRICING_PLN_LEGACY_PRICING_WARNING).format({helpCenterLink:s.Z.getArticleURL(o.BhN.LOCALIZED_PRICING)})})]})}},125313:(e,n,t)=>{t.d(n,{Z:()=>o});var r=t(785893),a=(t(667294),t(892472)),i=t(959797),l=t(241387),s=t.n(l);const o=function(e){var n=e.onClick;return(0,r.jsx)(a.Z,{onClick:n,className:s().link,children:i.Z.Messages.BACK})}},279480:(e,n,t)=>{t.d(n,{w:()=>d,H:()=>f});var r=t(667294),a=t(791462),i=t(992497),l=t(916957),s=t(922877),o=t(590483),u=t(609993),c=t(959797);function d(e,n,t){r.useEffect((function(){
if(null!=e&&e.isPurchasedExternally&&null!=e.paymentGateway&&!t){i.Z.show({title:c.Z.Messages.BILLING_EXTERNAL_HEADER.format({paymentGatewayName:u.Vz[e.paymentGateway]}),body:c.Z.Messages.BILLING_EXTERNAL_MANAGE_ELSEWHERE.format({paymentGatewayName:u.Vz[e.paymentGateway],subscriptionManagementLink:(0,o.JE)(e.paymentGateway,"SUBSCRIPTION_MANAGEMENT")}),confirmText:c.Z.Messages.OKAY});n()}}),[e])}var p=[];function f(e,n){var t=(0,a.e7)([l.Z],(function(){return l.Z.get(e)})),i=(0,a.e7)([s.Z],(function(){var e;return null!=t&&null!==(e=s.Z.getForSku(t.skuId))&&void 0!==e?e:p})),u=r.useMemo((function(){return Array.from(i).filter((function(e){var n=e.parentId,t=e.consumed;return null!=n&&!t}))}),[i]);return{hasEntitlements:!n&&null!=t&&null!=u&&u.length>=o.ZP.getIntervalMonths(t.interval,t.intervalCount),entitlements:u}}},677839:(e,n,t)=>{t.d(n,{T:()=>B,Z:()=>D});var r=t(785893),a=t(667294),i=t(441143),l=t.n(i),s=t(791462),o=t(512172),u=t(305630),c=t(173436),d=t(323657);function p(e,n){
if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function f(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}function I(e){I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return I(e)}function _(e,n){return!n||"object"!==S(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function E(e,n){E=Object.setPrototypeOf||function(e,n){e.__proto__=n;return e};return E(e,n)}var S=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function m(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))
;return!0}catch(e){return!1}}();return function(){var t,r=I(e);if(n){var a=I(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return _(this,t)}}var h=null,y=null,T=null;function N(e){var n=e.error;h=n}function v(){h=null}var P=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}});n&&E(e,n)}(t,e);var n=m(t);function t(){p(this,t);return n.apply(this,arguments)}var r=t.prototype;r.getGiftCode=function(e){return e===T?y:null};r.__getLocalVars=function(){return{paymentError:h,giftCode:y,giftCodeSkuId:T}};!function(e,n,t){n&&f(e.prototype,n);t&&f(e,t)}(t,[{key:"paymentError",get:function(){return h}}]);return t}(s.ZP.Store);P.displayName="PremiumPaymentModalStore";const b=new P(c.Z,{PREMIUM_PAYMENT_SUBSCRIBE_FAIL:N,PREMIUM_PAYMENT_UPDATE_FAIL:N,
PREMIUM_PAYMENT_SUBSCRIBE_SUCCESS:function(){v()},PREMIUM_PAYMENT_UPDATE_SUCCESS:v,PREMIUM_PAYMENT_ERROR_CLEAR:v,BRAINTREE_TOKENIZE_PAYPAL_FAIL:function(e){var n=e.message,t=e.code;h=new d.HF(n,t)},BRAINTREE_TOKENIZE_VENMO_FAIL:function(e){var n=e.message,t=e.code;h=new d.HF(n,t)},SKU_PURCHASE_SUCCESS:function(e){y=e.giftCode;T=e.skuId},SKU_PURCHASE_FAIL:function(e){h=e.error},SKU_PURCHASE_AWAIT_CONFIRMATION:function(e){e.isGift&&(T=e.skuId)},GIFT_CODE_CREATE:function(e){var n=e.giftCode;if(0!==n.uses||n.sku_id!==T)return!1;y=n.code}});var A=t(916957),O=t(512238),C=t(191940),g=t(956299),R=t(590483),M=t(796805),L=t(298716),x=t(461061),j=t(959797),Z=t(618941),G=t.n(Z);function w(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function U(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{
for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return w(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e){var n,t,a,i=e.planId,o=e.startingPremiumSubscriptionPlanId,u=e.paymentSourceType,c=U((0,s.Wu)([A.Z],(function(){return[A.Z.get(o),A.Z.get(i)]})),2),d=c[0],p=c[1];l()(null!=d&&null!=p,"Missing startingPlan or newPlan");if(t=o,a=i,L.Y1.indexOf(t)<L.Y1.indexOf(a))switch(i){case L.Xh.PREMIUM_MONTH_TIER_1:
n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_1;x.X7u.has(null!=u?u:x.HeQ.UNKNOWN)&&(n=j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_TIER_1.format());break;case L.Xh.PREMIUM_MONTH_TIER_2:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_UPGRADE_TIER_2_MONTH;x.X7u.has(null!=u?u:x.HeQ.UNKNOWN)&&(n=j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_TIER_2.format());break;case L.Xh.PREMIUM_YEAR_TIER_1:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_UPGRADE_TIER_1_YEAR;x.X7u.has(null!=u?u:x.HeQ.UNKNOWN)&&(n=j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_UPGRADE_TIER_1_YEAR.format());break;case L.Xh.PREMIUM_YEAR_TIER_2:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_UPGRADE_TIER_2_YEAR.format({numFreeGuildSubscriptions:L.cb});x.X7u.has(null!=u?u:x.HeQ.UNKNOWN)&&(n=j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_UPGRADE_TIER_2_YEAR.format({numFreeGuildSubscriptions:L.cb}));break;case L.Xh.PREMIUM_3_MONTH_TIER_2:case L.Xh.PREMIUM_6_MONTH_TIER_2:
n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_UPGRADE_TIER_2_MULTI_MONTH;break;case L.Xh.PREMIUM_MONTH_TIER_0:case L.Xh.PREMIUM_YEAR_TIER_0:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TO_TIER_0;break;default:throw new Error("Unexpected planId: ".concat(i))}else if(d.skuId===L.Si.TIER_2&&p.skuId===L.Si.TIER_1)n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_2_TO_TIER_1;else switch(p.skuId){case L.Si.TIER_0:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TO_TIER_0;break;case L.Si.TIER_1:n=j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_1_YEAR_TO_MONTH;break;case L.Si.TIER_2:n=1!==d.intervalCount?j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_2_GENERIC_TO_MONTH:j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_2_YEAR_TO_MONTH;break;default:throw new Error("Unexpected skuId: ".concat(p.skuId))}return(0,r.jsx)("div",{className:G().text,children:n})}function D(e){
var n,t=e.planId,i=e.enableNoPaymentTrial,u=e.startingPremiumSubscriptionPlanId,c=e.onClose,d=e.followupSKUInfo,p=e.isDowngrade,f=e.hideClose,I=e.postSuccessGuild,_=e.paymentSourceType,E=a.useContext(g.Z),S=(0,s.e7)([O.Z],(function(){return null!=d?O.Z.get(d.id):null}));a.useEffect((function(){if(null!=d&&null==S){var e=d.applicationId,n=d.id;(0,o.jU)(e,n).catch(x.VqG)}}),[d,S]);var m=function(e){return e.skuId===L.Si.TIER_0?x.X7u.has(null!=_?_:x.HeQ.UNKNOWN)?j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_TIER_1.format():j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_0:e.skuId===L.Si.TIER_1?x.X7u.has(null!=_?_:x.HeQ.UNKNOWN)?j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_TIER_1.format():j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_1:x.X7u.has(null!=_?_:x.HeQ.UNKNOWN)?j.Z.Messages.BILLING_SWITCH_PLAN_DELAYED_CONFIRMATION_TIER_2.format():i?j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_2_NO_PAYMENT_TRIAL:j.Z.Messages.BILLING_SWITCH_PLAN_CONFIRM_TIER_2};if(null!=S)n=(0,
r.jsx)("div",{className:G().text,children:j.Z.Messages.PREMIUM_PAYMENT_CONFIRMATION_BLURB_IAP.format({skuName:S.name})});else if(null!=u)n=(0,r.jsx)(k,{planId:t,startingPremiumSubscriptionPlanId:u});else if(null!=I){var h=A.Z.get(t);l()(null!=h,"Missing plan");n=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:G().text,children:m(h)}),(0,r.jsx)("div",{className:G().text,children:j.Z.Messages.BILLING_POST_PURCHASE_JOIN_GUILD_FOR_EMOJI.format({guildName:I.name})})]})}else{var y=A.Z.get(t);l()(null!=y,"Missing plan");n=(0,r.jsx)("div",{className:G().text,children:m(y)})}var T,N=R.ZP.getPremiumType(t);l()(null!=N,"premium type should not be null in purchase confirmation");T=null!=S?j.Z.Messages.PREMIUM_PAYMENT_CONFIRMATION_BUTTON_IAP.format({skuName:S.name}):p?j.Z.Messages.PREMIUM_DOWNGRADE_DONE_BUTTON:null!=I?j.Z.Messages.BILLING_POST_PURCHASE_JOIN_GUILD_FOR_EMOJI_CTA:j.Z.Messages.PREMIUM_UPGRADE_DONE_BUTTON;return(0,r.jsxs)("div",{className:G().confirmation,children:[(0,
r.jsx)(M.C,{className:G().banner,theme:E,premiumType:N,type:x.X7u.has(null!=_?_:x.HeQ.UNKNOWN)?M.C.Types.PREMIUM_PAYMENT_STARTED:null!=u?M.C.Types.PREMIUM_UPDATED:M.C.Types.PREMIUM_ACTIVATED}),n,f?null:(0,r.jsx)(C.Co,{onClick:c,children:T})]})}function B(e){var n=e.planId,t=e.selectedGiftStyle,a=e.onClose,i=(0,s.e7)([A.Z],(function(){return A.Z.get(n)}));l()(null!=i,"Missing plan");var o=(0,s.e7)([b],(function(){return b.getGiftCode(i.skuId)}));return(0,r.jsx)(u.Z,{giftCode:o,subscriptionPlan:i,onClose:a,selectedGiftStyle:t})}},230903:(e,n,t)=>{t.d(n,{Z:()=>k});var r=t(785893),a=(t(667294),t(441143)),i=t.n(a),l=t(43833),s=t(791462),o=t(489992),u=t(238307),c=t(556137),d=t(909187),p=t(655868),f=t(428455),I=t(832010),_=t(154765),E=t(851225),S=t(893321),m=t(378564),h=t(916957),y=t(326440),T=t(82961),N=t(562181),v=t(436035),P=t(590483),b=t(56435),A=t(212658),O=t(939042),C=t(988231),g=t(470352),R=t(112508),M=t(279480),L=t(461061),x=t(609993),j=t(959797),Z=t(968071),G=t.n(Z);function w(e,n){
(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function U(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return w(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e){
var n,t,a=e.selectedPlanId,Z=e.paymentSources,w=e.priceOptions,k=e.currencies,D=e.onCurrencyChange,B=e.isGift,H=void 0!==B&&B,F=e.onPaymentSourceChange,W=e.handlePaymentSourceAdd,Y=e.setHasAcceptedTerms,K=e.legalTermsNodeRef,V=e.hasLegalTermsFlash,X=e.trialId,Q=e.trialFooterMessageOverride,z=e.reviewWarningMessage,J=e.metadata,q=e.purchaseState,$=e.hideSubscriptionDetails,ee=(0,s.e7)([h.Z],(function(){return h.Z.get(a)})),ne=null!=X;i()(null!=ee,"Missing plan");var te,re,ae=[{planId:ee.id,quantity:1}],ie=q===_.A.PURCHASING||q===_.A.COMPLETED,le=H||ie,se=U((0,A.ED)({items:ae,renewal:!1,preventFetch:le,applyEntitlements:!0,paymentSourceId:w.paymentSourceId,currency:w.currency,trialId:X,metadata:J}),2),oe=se[0],ue=se[1],ce=U((0,A.ED)({items:ae,renewal:!0,preventFetch:le,trialId:X,paymentSourceId:w.paymentSourceId,currency:w.currency,metadata:J}),2),de=ce[0],pe=ce[1],fe=null!=ue?ue:pe,Ie=(0,s.e7)([S.Z],(function(){return S.Z.enabled})),_e=w.paymentSourceId,Ee=(0,
M.H)(ee.id,H),Se=Ee.hasEntitlements,me=Ee.entitlements,he=(0,P.Ap)(w.paymentSourceId),ye=(0,E.sE)(X,_e,a);if(null!=fe){var Te=fe.message;fe.code===f.SM.INVALID_CURRENCY_FOR_PAYMENT_SOURCE&&(Te=j.Z.Messages.BILLING_ERROR_UNSUPPORTED_CURRENCY);return(0,r.jsx)(y.Z,{children:Te})}if(H)re=(0,r.jsx)(R.e9,{paymentSourceId:w.paymentSourceId,plan:ee,className:G().invoice,isPrepaidPaymentSource:he});else{if(null==oe||null==de)return(0,r.jsx)(T.Z,{});ne&&oe.subscriptionPeriodEnd!==de.subscriptionPeriodEnd&&(te=oe.subscriptionPeriodEnd);re=(0,r.jsxs)(O.PO,{className:G().invoice,children:[(0,r.jsx)(O.q9,{children:j.Z.Messages.BILLING_SWITCH_PLAN_PURCHASE_DETAILS}),(0,r.jsx)(R.Lu,{invoice:oe,newPlan:ee,isPrepaidPaymentSource:he}),he?null:(0,r.jsx)(R.nd,{renewalInvoice:de,isTrial:ne,priceOptions:w,overrideRenewalDate:te,trialFooterMessageOverride:Q,hideSubscriptionDetails:$})]})}var Ne=l.M.EEA_COUNTRIES.has(m.Z.ipCountryCodeWithFallback),ve=function(e,n,t){var r=null,a=null,i=null;if(e&&null!=n){
var l=P.ZP.getIntervalForInvoice(n),s=l.intervalType,o=l.intervalCount,u=(0,b.og)((0,b.T4)(n.total,n.currency),s,o),c=null!=t?t:n.subscriptionPeriodEnd;r=j.Z.Messages.BILLING_LEGAL_MUMBO_JUMBO_TRIAL_TERMS_LABEL.format({termsURL:L.EYA.TERMS,paidURL:L.EYA.PAID_TERMS,rate:u,renewalDate:c});a=G().trialCheckbox;i=G().trialCheckboxLabel}return{checkboxLabel:r,checkboxClassname:a,checkboxLabelClassname:i}}(ne,de,te),Pe=ve.checkboxLabel,be=ve.checkboxClassname,Ae=ve.checkboxLabelClassname,Oe=j.Z.Messages.BILLING_SELECT_PLAN_GUILD_SUBSCRIPTION.format({planName:ee.name});H?Oe=j.Z.Messages.PAYMENT_MODAL_SUBTITLE_PREMIUM_GIFT:(0,P.PV)(ee.id)&&(Oe=P.ZP.getBillingReviewSubheader(null,ee));return ye?null:(0,r.jsxs)("div",{className:G().stepBody,children:[null!=z&&(0,r.jsxs)("div",{className:G().reviewWarningMessageContainer,children:[(0,r.jsx)(v.Z,{color:(0,I.Lq)(L.Ilk.STATUS_YELLOW_500),width:20,height:20}),(0,r.jsx)(o.xv,{className:G().reviewWarningMessage,variant:"text-sm/normal",children:z})]
}),(0,r.jsx)(N.vw,{tag:N.RB.H5,children:Oe}),re,(0,r.jsxs)("div",{className:G().paymentSourceWrapper,children:[(0,r.jsx)(N.vw,{tag:N.RB.H5,children:j.Z.Messages.PAYMENT_SOURCE_PAYMENT_REQUEST_INFO_TITLE}),(0,r.jsx)(d.Z,{paymentSources:Object.values(Z),selectedPaymentSourceId:_e,prependOption:Se?{label:j.Z.Messages.ATTACH_PAYMENT_SOURCE_PROMPT_OPTION_OPTIONAL,value:null}:null,onChange:F,onPaymentSourceAdd:W,hidePersonalInformation:Ie}),Se&&null==_e?(0,r.jsx)("div",{className:G().paymentSourceOptionalWarning,children:j.Z.Messages.ATTACH_PAYMENT_SOURCE_OPTIONAL_WITH_ENTITLEMENTS_WARNING.format({months:me.length})}):null,null==_e||(null===(n=Z[_e])||void 0===n?void 0:n.type)!=x.He.VENMO?(0,r.jsx)(C.Z,{className:G().paymentSourceVenmoPromo,isGift:H,skuId:ee.skuId}):null,(0,r.jsxs)(u.b,{currencies:k,className:G().currencyWrapper,children:[(0,r.jsx)(N.vw,{tag:N.RB.H5,children:j.Z.Messages.PAYMENT_CURRENCY}),(0,r.jsx)(u.Z,{selectedCurrency:w.currency,currencies:k,onChange:D})]})]}),(0,
r.jsx)(g.Z,{isActive:V,ref:K,children:(0,r.jsx)(p.Z,{onChange:Y,forceShow:!0,checkboxLabel:Pe,checkboxClassname:be,checkboxLabelClassname:Ae,finePrint:(0,r.jsx)(c.Z,{hide:ne,subscriptionPlan:ee,isGift:H,paymentSourceType:null===(t=Z[null!=_e?_e:""])||void 0===t?void 0:t.type}),showPricingLink:ee.currency!==x.pK.USD,showWithdrawalWaiver:Ne,disabled:ie})})]})}},711462:(e,n,t)=>{t.d(n,{Z:()=>F});var r=t(785893),a=t(667294),i=t(441143),l=t.n(i),s=t(791462),o=t(173436),u=t(737325),c=t(976882),d=t(951667),p=t(512172),f=t(64833),I=t(154765),_=t(851225),E=t(551705),S=t(775584),m=t(707955),h=t(792018),y=t(916957),T=t(191940),N=t(487502),v=t(757987),P=t(67416),b=t(932847),A=t(590483),O=t(862325),C=t(194503),g=t(125313),R=t(279480),M=t(298716),L=t(461061),x=t(609993),j=t(959797);function Z(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function G(e,n,t,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){t(e);return}s.done?n(o):Promise.resolve(o).then(r,a)
}function w(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var i=e.apply(n,t);function l(e){G(i,r,a,l,s,"next",e)}function s(e){G(i,r,a,l,s,"throw",e)}l(void 0)}))}}function U(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function k(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))));r.forEach((function(n){U(e,n,t[n])}))}return e}function D(e,n){n=null!=n?n:{};Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})));t.push.apply(t,r)}return t
}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}));return e}function B(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,s=!1;try{for(t=t.call(e);!(l=(r=t.next()).done);l=!0){i.push(r.value);if(n&&i.length===n)break}}catch(e){s=!0;a=e}finally{try{l||null==t.return||t.return()}finally{if(s)throw a}}return i}}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return Z(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}
var H=function(e,n){var t,r,a,i,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;(r=0,a)&&(i=[2&i[0],a.value]);switch(i[0]){case 0:case 1:a=i;break;case 4:l.label++;return{value:i[1],done:!1};case 5:l.label++;r=i[1];i=[0];continue;case 7:i=l.ops.pop();l.trys.pop();continue;default:if(!(a=l.trys,a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1];a=i;break}if(a&&l.label<a[2]){l.label=a[2];l.ops.push(i);break}a[2]&&l.ops.pop();l.trys.pop();continue}i=n.call(e,l)}catch(e){i=[6,e];r=0}finally{t=a=0}
if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function F(e){var n=e.premiumSubscription,t=e.planId,i=e.setPurchaseState,Z=e.setHasAcceptedTerms,G=e.hasAcceptedTerms,U=e.priceOptions,F=e.onBack,W=e.onNext,Y=e.legalTermsNodeRef,K=e.flashLegalTerms,V=e.invoiceError,X=e.planError,Q=e.onPurchaseError,z=e.baseAnalyticsData,J=e.flowStartTime,q=e.isGift,$=void 0!==q&&q,ee=e.giftStyle,ne=e.trialId,te=e.planGroup,re=e.analyticsLocation,ae=e.purchaseTokenAuthState,ie=e.openInvoiceId,le=e.metadata,se=e.backButtonEligible,oe=e.disablePurchase,ue=function(){if(null!=Y.current){Y.current.scrollIntoView({behavior:"smooth"});K()}},ce=(0,s.e7)([y.Z],(function(){return y.Z.get(t)})),de=(0,_.sE)(ne,U.paymentSourceId,t),pe=(0,s.e7)([S.Z],(function(){return S.Z.popupCallbackCalled})),fe=(0,f.Z)().analyticsLocations;l()(null!=ce,"Missing subscriptionPlan");var Ie=U.paymentSourceId,_e=(0,s.e7)([m.Z],(function(){return null!=Ie?m.Z.getPaymentSource(Ie):null
})),Ee=B(a.useState(de),2),Se=Ee[0],me=Ee[1],he=B(a.useState(!1),2),ye=he[0],Te=he[1],Ne=(0,R.H)(t,$).hasEntitlements,ve=(0,A.Ap)(U.paymentSourceId),Pe=function(e,n,t,r,a){return t?j.Z.Messages.PAYMENT_MODAL_BUTTON_PREMIUM_GIFT:a?j.Z.Messages.BILLING_SELECT_PLAN:null!=n?(0,O.R4)(n,e.id,r)?j.Z.Messages.BILLING_SWITCH_PLAN_UPGRADE:j.Z.Messages.BILLING_SWITCH_PLAN_CHANGE:(0,A.PV)(e.id)?(0,A.W_)(null,e):j.Z.Messages.BILLING_SELECT_PLAN_GUILD_SUBSCRIPTION.format({planName:e.name})}(ce,n,$,te,ve);a.useEffect((function(){var e,n=(e=w((function(){var e;return H(this,(function(n){switch(n.label){case 0:if(!0!==pe)return[3,6];n.label=1;case 1:n.trys.push([1,3,4,5]);return null==S.Z.redirectedPaymentId?[2]:[4,(0,u.OP)(S.Z.redirectedPaymentId)];case 2:n.sent();i(I.A.COMPLETED);W();return[3,5];case 3:e=n.sent();i(I.A.FAIL);Q(e);b.default.track(L.rMx.PAYMENT_FLOW_FAILED,D(k({},z),{payment_source_id:Ie,duration_ms:Date.now()-J}));return[3,5];case 4:me(!1);(0,u.K2)();return[7];case 5:return[3,8]
;case 6:return ae!==h.I.SUCCESS?[3,8]:[4,Ce()];case 7:n.sent();n.label=8;case 8:return[2]}}))})),function(){return e.apply(this,arguments)});n()}),[pe]);a.useEffect((function(){de&&!$&&null==n&&Ce()}),[de,$,n]);var be,Ae,Oe=(0,C.U)(),Ce=(be=w((function(){var e,r,a,s,f;return H(this,(function(_){switch(_.label){case 0:i(I.A.PURCHASING);Z(!0);me(!0);o.Z.wait(c.fw);Q(null);_.label=1;case 1:_.trys.push([1,13,14,15]);l()(null!=_e||Ne||de,"Missing paymentSource");b.default.track(L.rMx.PAYMENT_FLOW_COMPLETED,D(k({},z),{duration_ms:Date.now()-J}));if(ye)return[2];if(!$)return[3,3];r=(0,A.aS)(ce.id,!1,!0,U);return[4,(0,p.ZZ)(M.RQ,ce.skuId,{expectedAmount:r.amount,expectedCurrency:r.currency,paymentSource:_e,subscriptionPlanId:t,isGift:!0,giftStyle:ee})];case 2:e=_.sent();return[3,12];case 3:return Oe&&null!=ie&&null!=_e&&null!=n?x.Uk.has(_e.type)?[4,(0,u.G)(n,ie,_e,U.currency)]:[3,5]:[3,8];case 4:a=_.sent();return[3,7];case 5:return[4,(0,u.Mg)(n,{paymentSource:_e,currency:U.currency},fe,re)]
;case 6:a=_.sent();_.label=7;case 7:e=a;return[3,12];case 8:return null==n?[3,10]:[4,(0,u.Mg)(n,{items:(0,A.al)(n,t,1,new Set(te)),paymentSource:_e,currency:U.currency},fe,re)];case 9:e=_.sent();return[3,12];case 10:return[4,(0,d.Ld)({planId:t,currency:U.currency,paymentSource:_e,trialId:ne,metadata:le})];case 11:e=_.sent();_.label=12;case 12:if(e.redirectConfirmation){Te(null!=e.redirectURL);return[2]}i(I.A.COMPLETED);if("subscription"in e){s=null!=e.subscription?E.Z.createFromServer(e.subscription):null;W(s)}else W();return[3,15];case 13:f=_.sent();i(I.A.FAIL);Q(f);b.default.track(L.rMx.PAYMENT_FLOW_FAILED,D(k({},z),{payment_source_id:Ie,duration_ms:Date.now()-J}));return[3,15];case 14:ye||me(!1);return[7];case 15:return[2]}}))})),function(){return be.apply(this,arguments)});Ae=null!=V||null!=X||oe?(0,r.jsx)(T.Co,{color:T.Co.Colors.GREEN,disabled:!0,children:Pe}):G?(0,r.jsx)(T.Co,{"data-testid":"purchase",onClick:Ce,color:T.Co.Colors.GREEN,submitting:Se,disabled:null==Ie&&!Ne,
children:Pe}):(0,r.jsx)(v.ZP,{text:j.Z.Messages.BILLING_ACCEPT_TERMS_PAID_SERVICES_TOOLTIP,children:function(e){return(0,r.jsx)(T.Co,D(k({},e),{color:T.Co.Colors.GREEN,type:"submit",onClick:ue,"data-testid":"submitButton",children:Pe}))}});var ge=null!=ie;return de?null:(0,r.jsxs)(P.mz,{justify:N.Z.Justify.BETWEEN,align:N.Z.Align.CENTER,children:[Ae,se&&!ge?(0,r.jsx)(g.Z,{onClick:F}):null]})}},672561:(e,n,t)=>{t.d(n,{Z:()=>r});const r=[{label:"Alberta",value:"AB"},{label:"British Columbia",value:"BC"},{label:"Manitoba",value:"MB"},{label:"New Brunswick",value:"NB"},{label:"Newfoundland and Labrador",value:"NL"},{label:"Nova Scotia",value:"NS"},{label:"Ontario",value:"ON"},{label:"Prince Edward Island",value:"PE"},{label:"Quebec",value:"QC"},{label:"Saskatchewan",value:"SK"},{label:"Northwest Territories",value:"NT"},{label:"Nunavut",value:"NU"},{label:"Yukon",value:"YT"}]},188068:(e,n,t)=>{t.d(n,{Z:()=>r});const r=[{label:"Alabama",value:"AL"},{label:"Alaska",value:"AK"},{
label:"American Samoa",value:"AS"},{label:"Arizona",value:"AZ"},{label:"Arkansas",value:"AR"},{label:"Armed Forces: Americas",value:"AA"},{label:"Armed Forces: Europe",value:"AE"},{label:"Armed Forces: Pacific",value:"AP"},{label:"California",value:"CA"},{label:"Colorado",value:"CO"},{label:"Connecticut",value:"CT"},{label:"Delaware",value:"DE"},{label:"District Of Columbia",value:"DC"},{label:"Federated States Of Micronesia",value:"FM"},{label:"Florida",value:"FL"},{label:"Georgia",value:"GA"},{label:"Guam",value:"GU"},{label:"Hawaii",value:"HI"},{label:"Idaho",value:"ID"},{label:"Illinois",value:"IL"},{label:"Indiana",value:"IN"},{label:"Iowa",value:"IA"},{label:"Kansas",value:"KS"},{label:"Kentucky",value:"KY"},{label:"Louisiana",value:"LA"},{label:"Maine",value:"ME"},{label:"Marshall Islands",value:"MH"},{label:"Maryland",value:"MD"},{label:"Massachusetts",value:"MA"},{label:"Michigan",value:"MI"},{label:"Minnesota",value:"MN"},{label:"Mississippi",value:"MS"},{label:"Missouri",
value:"MO"},{label:"Montana",value:"MT"},{label:"Nebraska",value:"NE"},{label:"Nevada",value:"NV"},{label:"New Hampshire",value:"NH"},{label:"New Jersey",value:"NJ"},{label:"New Mexico",value:"NM"},{label:"New York",value:"NY"},{label:"North Carolina",value:"NC"},{label:"North Dakota",value:"ND"},{label:"Northern Mariana Islands",value:"MP"},{label:"Ohio",value:"OH"},{label:"Oklahoma",value:"OK"},{label:"Oregon",value:"OR"},{label:"Palau",value:"PW"},{label:"Pennsylvania",value:"PA"},{label:"Puerto Rico",value:"PR"},{label:"Rhode Island",value:"RI"},{label:"South Carolina",value:"SC"},{label:"South Dakota",value:"SD"},{label:"Tennessee",value:"TN"},{label:"Texas",value:"TX"},{label:"Utah",value:"UT"},{label:"Vermont",value:"VT"},{label:"Virgin Islands",value:"VI"},{label:"Virginia",value:"VA"},{label:"Washington",value:"WA"},{label:"West Virginia",value:"WV"},{label:"Wisconsin",value:"WI"},{label:"Wyoming",value:"WY"}]},530853:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(667294);var a=[]
;function i(e,n){var t=(0,r.useRef)(),i=(0,r.useRef)(a);if(i.current===a){t.current=e();i.current=n}else if(!function(e,n){if(e.length!==n.length)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!Object.is(e[t],n[t]))return!1;return!0}(n,i.current)){t.current=e();i.current=n}return t.current}}}]);
//# sourceMappingURL=2b77a38ee92f00ef0b38.js.map